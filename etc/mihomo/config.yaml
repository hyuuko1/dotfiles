# https://wiki.metacubex.one/config/

# å‚è€ƒäº†ï¼šhttps://github.com/Toperlock/Clash/blob/main/mihomo.yaml

# å¤–éƒ¨æ§åˆ¶å™¨ï¼Œå¯ä»¥ä½¿ç”¨ RESTful API æ¥æ§åˆ¶ä½ çš„ Clash å†…æ ¸
external-controller: 127.0.0.1:9090
secret: "" # clash API è®¿é—®å¯†é’¥
# clash å¯ä»¥è‡ªå·±æ‰˜ç®¡å¤–éƒ¨æ§åˆ¶å™¨çš„é™æ€ç½‘é¡µèµ„æºï¼Œurl æ˜¯ http://localhost:9090/ui/
external-ui: ui # é™æ€ç½‘é¡µèµ„æºæ‰€åœ¨ç›®å½•ã€‚æ˜¯ clash å·¥ä½œç›®å½• /etc/mihomo çš„ç›¸å¯¹è·¯å¾„ã€‚
# è®© clash è‡ªå·±ä¸‹è½½
external-ui-url: "https://gh-proxy.com/https://github.com/Zephyruso/zashboard/releases/latest/download/dist-cdn-fonts.zip"

# è¿è¡Œæ¨¡å¼ rule/global/direct
mode: rule
log-level: warning # clash åœ¨æ§åˆ¶å°æ‰“å°çš„æ—¥å¿—çº§åˆ«

mixed-port: 7897 # æ··åˆç«¯å£ï¼ŒHTTP å’Œ SOCKS5 ç”¨ä¸€ä¸ªç«¯å£
# port: 7891          # HTTP(S) ä»£ç†æœåŠ¡å™¨ç«¯å£
# socks-port: 7892    # SOCKS5 ä»£ç†ç«¯
# redir-port: 7893    # é€æ˜ä»£ç†ç«¯å£ï¼Œç”¨äº Linux å’Œ MacOS
# tproxy-port: 7894   # Transparent proxy server port for Linux (TProxy TCP and TProxy UDP)

allow-lan: true # å…è®¸å±€åŸŸç½‘çš„å…¶ä»–è®¾å¤‡ä½¿ç”¨æ­¤ä»£ç†æœåŠ¡
ipv6: true # é»˜è®¤å¼€å¯ã€‚IPv6 æ€»å¼€å…³ï¼Œå…³é—­é˜»æ–­æ‰€æœ‰ IPv6 è¿æ¥å’Œå±è”½ DNS è¯·æ±‚ AAAA è®°å½•
udp: true # æ˜¯å¦å…è®¸ UDP é€šè¿‡ä»£ç†ï¼Œé»˜è®¤ä¸º false

# ç¼“å­˜
profile:
  store-selected: true # å‚¨å­˜ API å¯¹ç­–ç•¥ç»„çš„é€‰æ‹©ï¼Œä»¥ä¾›ä¸‹æ¬¡å¯åŠ¨æ—¶ä½¿ç”¨
  store-fake-ip: true # å‚¨å­˜ fakeip æ˜ å°„è¡¨ï¼ŒåŸŸåå†æ¬¡å‘ç”Ÿè¿æ¥æ—¶ï¼Œä½¿ç”¨åŸæœ‰æ˜ å°„åœ°å€

find-process-mode: off # ä¸åŒ¹é…è¿›ç¨‹
unified-delay: true # å¼€å¯ç»Ÿä¸€å»¶è¿Ÿæ—¶ï¼Œä¼šè¿›è¡Œä¸¤æ¬¡å»¶è¿Ÿæµ‹è¯•ï¼Œä»¥æ¶ˆé™¤è¿æ¥æ¡æ‰‹ç­‰å¸¦æ¥çš„ä¸åŒç±»å‹èŠ‚ç‚¹çš„å»¶è¿Ÿå·®å¼‚
tcp-concurrent: true # å¯ç”¨ TCP å¹¶å‘è¿æ¥æ—¶ï¼Œå°†ä¼šä½¿ç”¨ dns è§£æå‡ºçš„æ‰€æœ‰ IP åœ°å€è¿›è¡Œè¿æ¥ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªæˆåŠŸçš„è¿æ¥
global-client-fingerprint: chrome # å…¨å±€ TLS æŒ‡çº¹ï¼Œä¼˜å…ˆä½äº proxy å†…çš„ client-fingerprintï¼Œç›®å‰æ”¯æŒå¼€å¯ TLS ä¼ è¾“çš„ TCP/grpc/WS/HTTP, æ”¯æŒåè®®æœ‰ VLESS,Vmess å’Œ trojan

geodata-mode: false # æ›´æ”¹ geoip ä½¿ç”¨æ–‡ä»¶ï¼Œtrue ä½¿ç”¨ datï¼Œé»˜è®¤å€¼ false ä½¿ç”¨ mmdbï¼ˆè¿™ç§æ ¼å¼æ›´å¥½ï¼‰
geodata-loader: standard # åŠ è½½æ¨¡å¼ï¼Œå°å†…å­˜æœºå™¨ç”¨ memconservative
geo-auto-update: false
geox-url:
  geoip: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
  geosite: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
  mmdb: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb"
  asn: "https://github.com/xishang0128/geoip/releases/download/latest/GeoLite2-ASN.mmdb"

# https://wiki.metacubex.one/config/dns/
# https://wiki.metacubex.one/config/dns/diagram/
dns:
  enable: true # å¦‚æœä¸º falseï¼Œåˆ™ä½¿ç”¨ç³»ç»Ÿ DNS è§£æã€‚https://chat.qwen.ai/s/feaca26c-b4ec-4f99-ad1f-62fe2e7d706e?fev=0.0.221
  prefer-h3: false # DOH ä¼˜å…ˆä½¿ç”¨ http/3
  listen: :53 # ç›‘å¬åœ°å€ã€‚clash ä¼šæä¾› DNS è§£ææœåŠ¡
  ipv6: true # æ˜¯å¦è§£æ IPV6, å¦‚ä¸º false, åˆ™å›åº” AAAA çš„ç©ºè§£æ
  enhanced-mode: fake-ip # DNS å¤„ç†æ¨¡å¼ï¼Œé»˜è®¤ redir-hostã€‚å¯ä»¥é…ç½®ä¸º fake-ip
  use-hosts: true # æ˜¯å¦æŸ¥è¯¢å½“å‰ config.yaml ä¸­çš„ host: é…ç½®ï¼Œé»˜è®¤ true
  use-system-hosts: true # æ˜¯å¦æŸ¥è¯¢ç³»ç»Ÿ hostsï¼Œé»˜è®¤ true
  respect-rules: true # ä¸º true æ—¶ï¼Œdns è¿æ¥éµå®ˆè·¯ç”±è§„åˆ™ï¼Œéœ€é…ç½® proxy-server-nameserverï¼Œå¼ºçƒˆä¸å»ºè®®å’Œ prefer-h3 ä¸€èµ·ä½¿ç”¨
  default-nameserver: # ç”¨äºè§£æ DNS æœåŠ¡å™¨æœ¬èº«çš„åŸŸåï¼ˆä¾‹å¦‚ï¼Œç”¨äºè§£æ dns.google è¿™ä¸ªåŸŸåçš„ IPï¼‰ã€‚å¿…é¡»æ˜¯çº¯ IP, å¯ä¸ºåŠ å¯† DNS
    - 119.29.29.29
    - 223.5.5.5
  # nameserver-policy: # æ ¹æ®è§„åˆ™ï¼Œè®©æŒ‡å®šçš„åŸŸåä½¿ç”¨æŒ‡å®šçš„ DNS æœåŠ¡å™¨ï¼Œä¼˜å…ˆçº§é«˜äº nameserver: å’Œ fallback:
  nameserver: # é»˜è®¤ä½¿ç”¨çš„ DNS æœåŠ¡å™¨
    - 119.29.29.29
    - 223.5.5.5
  fallback: # ç»è¿‡ fallback-filter ç­›é€‰çš„ï¼Œå°†ä¼šä½¿ç”¨ fallback: è§£æï¼Œå¦åˆ™ä½¿ç”¨ nameserver: è§£æ
    - https://dns.google/dns-query
    - https://dns.cloudflare.com/dns-query
  fallback-filter:
    geoip: true
    geoip-code: CN # DNS ç»“æœå±äº geoip CN æ—¶ï¼Œä¼šç›´æ¥é‡‡ç”¨ï¼Œå¦åˆ™ä½¿ç”¨ fallback: è§£æ
    geosite: # åŒ¹é…åˆ°ä¸‹åˆ—è§„åˆ™é›†çš„åŸŸåï¼Œä¼šè¢«è§†ä¸ºå·²æ±¡æŸ“ï¼Œä¼šç›´æ¥ä½¿ç”¨ fallback: è§£æ
      - gfw
    ipcidr: # DNS ç»“æœå±äºè¿™äº›ç½‘æ®µæ—¶ï¼Œä¼šè¢«è§†ä¸ºæ±¡æŸ“ï¼Œä¼šç›´æ¥ä½¿ç”¨ fallback: è§£æ
      - 240.0.0.0/4
    # domain: # è¿™äº›åŸŸåè¢«è§†ä¸ºå·²æ±¡æŸ“ï¼ŒåŒ¹é…åˆ°è¿™äº›åŸŸåï¼Œä¼šç›´æ¥ä½¿ç”¨ fallback: è§£æ
  direct-nameserver: # å¯¹äºè¦èµ°ç›´è¿çš„è¿æ¥ï¼Œä½¿ç”¨è¯¥ DNS æœåŠ¡å™¨ã€‚å¦‚æœä¸å¡«ï¼Œåˆ™éµå®ˆ nameserver-policyã€nameserver å’Œ fallback çš„é…ç½®
    - 119.29.29.29
    - 223.5.5.5
  proxy-server-nameserver: # ç”¨äºè§£æä»£ç†èŠ‚ç‚¹çš„åŸŸåã€‚å¦‚æœä¸å¡«ï¼Œåˆ™éµå®ˆ nameserver-policyã€nameserver å’Œ fallback çš„é…ç½®
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
    - https://dns.google/dns-query
    - https://dns.cloudflare.com/dns-query
  # ä½¿ç”¨ fake-ip æ—¶çš„é…ç½®
  fake-ip-range: 198.18.0.1/16 # fake-ip è§£æåœ°å€æ± 
  fake-ip-filter: # fake-ip è¿‡æ»¤ï¼Œä¸ºä»¥ä¸‹åŸŸåè¿”å›çœŸå® IP
    - "*" # åŒ¹é… localhost ç­‰æ²¡æœ‰ . çš„ä¸»æœºå
    - "+.lan"
    - "+.local"

# TUN
tun:
  enable: false
  stack: gvisor
  auto-route: true
  strict-route: false
  auto-detect-interface: true
  dns-hijack:
    - any:53

# åŸŸåå—…æ¢ https://wiki.metacubex.one/config/sniff/
# ä½œç”¨ï¼šRedir Host é…åˆ sniffer å¯ä»¥å®Œç¾è§£å†³åŸç‰ˆ clash çš„ä¸€äº›é—®é¢˜
# æ—§ç‰ˆæ–‡æ¡£ï¼š
# https://clash-meta.gitbook.io/clash.meta-wiki-older/function/dns/sniffer
# https://clash-meta.gitbook.io/clash.meta-wiki-older/function/dns/redirhost
sniffer:
  enable: false
  force-dns-mapping: true # å¯¹ redir-host ç±»å‹è¯†åˆ«çš„æµé‡è¿›è¡Œå¼ºåˆ¶å—…æ¢
  parse-pure-ip: true # å¯¹æ‰€æœ‰æœªè·å–åˆ°åŸŸåçš„æµé‡è¿›è¡Œå¼ºåˆ¶å—…æ¢
  override-destination: true # æ˜¯å¦ä½¿ç”¨å—…æ¢ç»“æœä½œä¸ºå®é™…è®¿é—®ï¼Œé»˜è®¤ä¸º true
  sniff:
    HTTP:
      ports: [80, 8080-8880] # portså­—æ®µï¼Œè¡¨ç¤ºç«¯å£èŒƒå›´ã€‚ç¤ºä¾‹ï¼šports: [80, 8080-8880]
      override-destination: true # override-destinationå­—æ®µï¼ˆå¯é€‰ï¼‰ï¼Œç”¨äºè¦†ç›–å…¨å±€override-destinationè®¾ç½®
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  # force-domain: # éœ€è¦å¼ºåˆ¶å—…æ¢çš„åŸŸåï¼ˆé»˜è®¤æƒ…å†µä¸‹åªå¯¹IPè¿›è¡Œå—…æ¢ï¼‰
  #   - +.v2ex.com
  skip-domain: # éœ€è¦è·³è¿‡å—…æ¢çš„åŸŸåã€‚ä¸»è¦è§£å†³éƒ¨åˆ†ç«™ç‚¹sniå­—æ®µéåŸŸåï¼Œå¯¼è‡´å—…æ¢ç»“æœå¼‚å¸¸çš„é—®é¢˜ï¼Œå¦‚ç±³å®¶è®¾å¤‡Mijia Cloud
    - "+.apple.com"
    - "dlg.io.mi.com"
    - "Mijia Cloud"
  # skip-src-address:
  #   - 192.168.0.3/32
  # skip-dst-address:
  #   - 192.168.0.3/32

# https://wiki.metacubex.one/config/dns/hosts/
# hosts:

proxy-providers:
  # https://èµ”é’±.com
  èµ”é’±æœºåœº:
    type: http
    url: https://dash.pqjc.site/api/v1/client/subscribe?token=64170a43564a180573b63642a6b1655f
    path: ./profiles/èµ”é’±æœºåœº.yaml
    interval: 86400 # æ¯å¤©æ›´æ–°
    proxy: DIRECT # æ›´æ–°è®¢é˜…æ—¶ï¼Œç›´è¿
    # header:
    #   User-Agent:
    #     - "Clash/v1.18.0"
    #     - "mihomo/1.18.3"
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 600 # 10 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
      timeout: 2000 # 2s è¶…æ—¶
      lazy: true
      expected-status: 204
    # è¦†å†™èŠ‚ç‚¹åŠ è½½æ—¶çš„ä¸€äº›é…ç½®é¡¹
    # override:

# ä»£ç†ç»„é”šç‚¹ã€‚ç”¨äºä¸ºä¸åŒç½‘ç«™é€‰æ‹©ä¸åŒçš„ä»£ç†æœåŠ¡å™¨
WebSiteRoute: &WebSiteRoute
  type: select
  proxies:
    [ğŸŒä»£ç†, DIRECT, ALL, ğŸ‡ºğŸ‡¸åŒ—ç¾, ğŸ‡¸ğŸ‡¬æ–°, ğŸ‡¯ğŸ‡µæ—¥, ğŸ‡°ğŸ‡·éŸ©, ğŸ‡­ğŸ‡°æ¸¯å°, ğŸ‡¦ğŸ‡ºæ¾³, ğŸ‡¬ğŸ‡§æ¬§, ğŸ…°ï¸AWS]
# ä»£ç†ç»„é”šç‚¹ã€‚ç”¨äºé€‰æ‹©ä»£ç†æœåŠ¡å™¨
ServerSelect: &ServerSelect
  #
  # type: select
  type: url-test
  # type: fallback
  url: https://www.gstatic.com/generate_204
  interval: 600
  tolerance: 200
  timeout: 2000
  lazy: true
  expected-status: 204
  max-failed-times: 3
  use: [èµ”é’±æœºåœº]
# ä»£ç†ç»„
proxy-groups:
  - type: select
    name: ğŸŒä»£ç†
    proxies: [DIRECT, ALL, ğŸ‡ºğŸ‡¸åŒ—ç¾, ğŸ‡¸ğŸ‡¬æ–°, ğŸ‡¯ğŸ‡µæ—¥, ğŸ‡°ğŸ‡·éŸ©, ğŸ‡­ğŸ‡°æ¸¯å°, ğŸ‡¦ğŸ‡ºæ¾³, ğŸ‡¬ğŸ‡§æ¬§, ğŸ…°ï¸AWS]
  - { <<: *WebSiteRoute, name: ğŸŒIç«™ }
  - { <<: *WebSiteRoute, name: ğŸŒEç«™ }
  - { <<: *WebSiteRoute, name: ğŸŒPIXIV }
  - { <<: *WebSiteRoute, name: ğŸŒMEGAäº‘ç›˜ }
  - { <<: *WebSiteRoute, name: ğŸŒArchLinux }
  - { <<: *WebSiteRoute, name: ğŸŒAI }
  - { <<: *WebSiteRoute, name: ğŸŒGmail }
  - { <<: *WebSiteRoute, name: ğŸŒTelegram }
  - { <<: *ServerSelect, name: ALL }
  - { <<: *ServerSelect, name: ğŸ‡¸ğŸ‡¬æ–°, filter: "(?i)æ–°|sing" }
  - { <<: *ServerSelect, name: ğŸ…°ï¸AWS, filter: "(?i)AWS" }
  - { <<: *ServerSelect, name: ğŸ‡¯ğŸ‡µæ—¥, filter: "(?i)æ—¥|jap" }
  - { <<: *ServerSelect, name: ğŸ‡­ğŸ‡°æ¸¯å°, filter: "(?i)æ¸¯|å°|kong|taiwan" }
  - { <<: *ServerSelect, name: ğŸ‡°ğŸ‡·éŸ©, filter: "(?i)éŸ©|kor" }
  - { <<: *ServerSelect, name: ğŸ‡¬ğŸ‡§æ¬§, filter: "(?i)è‹±|å¾·|æ³•|ç‘|king|fren|ger" }
  - { <<: *ServerSelect, name: ğŸ‡¦ğŸ‡ºæ¾³, filter: "(?i)æ¾³|aust" }
  - { <<: *ServerSelect, name: ğŸ‡ºğŸ‡¸åŒ—ç¾, filter: "(?i)ç¾|æ‹¿|us|state|cana" } # (?i) ä¸åŒºåˆ†å¤§å°å†™
  - name: â“å…¶ä»–æµé‡
    type: select
    proxies: [ğŸŒä»£ç†, DIRECT]

# è§„åˆ™é›†é”šç‚¹
RuleSet: &RuleSet
  type: file
  behavior: classical
#
rule-providers:
  è‡ªå®šä¹‰ä»£ç†: { <<: *RuleSet, path: ./rulesets/è‡ªå®šä¹‰ä»£ç†.yaml }
  è‡ªå®šä¹‰ç›´è¿: { <<: *RuleSet, path: ./rulesets/è‡ªå®šä¹‰ç›´è¿.yaml }
  æœ¬åœ°åä»£: { <<: *RuleSet, path: ./rulesets/æœ¬åœ°åä»£.yaml }

# è·¯ç”±è§„åˆ™ https://wiki.metacubex.one/config/rules/
# no-resolve é‡åˆ° IP ç±»è§„åˆ™æ—¶ï¼Œä¸è§£æåŸŸå
# é¡ºåºï¼šè‡ªå®šä¹‰ > é«˜é¢‘è®¿é—® > ä½é¢‘è®¿é—®
#
# è§„åˆ™é›†åˆã€‚å¯ä»¥ç”¨é€šé…ç¬¦ https://wiki.metacubex.one/config/rule-providers/content/
# å®‰è£… mihomo æ—¶ï¼Œä¼šå®‰è£… Country.mmdbï¼Œå…¶æ•°æ®æ¥æºäºï¼š
# https://github.com/MetaCubeX/meta-rules-dat/tree/meta/geo/geosite è¿™äº›æ–‡ä»¶åå°±æ˜¯è§„åˆ™é›†çš„åç§°
#
rules:
  # è‡ªå®šä¹‰ç›´è¿
  - RULE-SET,è‡ªå®šä¹‰ç›´è¿,DIRECT,no-resolve
  - RULE-SET,æœ¬åœ°åä»£,DIRECT,no-resolve
  - GEOSITE,steam@cn,DIRECT
  # å¯¹æŸäº›ç½‘ç«™å•ç‹¬è®¾ç½® outbound
  - GEOSITE,category-ai-!cn,ğŸŒAI
  - DOMAIN-SUFFIX,archlinux.org,ğŸŒArchLinux
  - DOMAIN-SUFFIX,iwara.tv,ğŸŒIç«™
  - DOMAIN-SUFFIX,gmail.com,ğŸŒGmail
  - GEOSITE,ehentai,ğŸŒEç«™
  - GEOSITE,mega,ğŸŒMEGAäº‘ç›˜
  - GEOSITE,pixiv,ğŸŒPIXIV
  # è‡ªå®šä¹‰ä»£ç†
  - RULE-SET,è‡ªå®šä¹‰ä»£ç†,ğŸŒä»£ç†,no-resolve
  - GEOSITE,category-ads-all,REJECT
  - GEOSITE,cn,DIRECT
  - GEOSITE,private,DIRECT
  - GEOSITE,geolocation-!cn,ğŸŒä»£ç†
  # IP è§„åˆ™
  - GEOIP,telegram,ğŸŒTelegram,no-resolve
  - GEOIP,private,DIRECT,no-resolve
  - GEOIP,cn,DIRECT,no-resolve
  - MATCH,â“å…¶ä»–æµé‡
  # å…¶ä»–
  # - DST-PORT,53,DIRECT
  # - NETWORK,UDP,DIRECT
