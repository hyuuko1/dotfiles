ç›®å½•

- [æ³¨æ„](#æ³¨æ„)
- [éƒ¨åˆ†å‚è€ƒèµ„æ–™](#éƒ¨åˆ†å‚è€ƒèµ„æ–™)
  - [ArchWiki](#archwiki)
- [å®‰è£…å‰çš„å‡†å¤‡](#å®‰è£…å‰çš„å‡†å¤‡)
  - [å¯åŠ¨åˆ° Live ç¯å¢ƒ](#å¯åŠ¨åˆ°-live-ç¯å¢ƒ)
  - [éªŒè¯å¯åŠ¨æ¨¡å¼](#éªŒè¯å¯åŠ¨æ¨¡å¼)
  - [è¿æ¥åˆ°å› ç‰¹ç½‘](#è¿æ¥åˆ°å› ç‰¹ç½‘)
  - [æ›´æ–°ç³»ç»Ÿæ—¶é—´](#æ›´æ–°ç³»ç»Ÿæ—¶é—´)
  - [å»ºç«‹ç¡¬ç›˜åˆ†åŒº](#å»ºç«‹ç¡¬ç›˜åˆ†åŒº)
  - [æ ¼å¼åŒ–åˆ†åŒº](#æ ¼å¼åŒ–åˆ†åŒº)
  - [æŒ‚è½½åˆ†åŒº](#æŒ‚è½½åˆ†åŒº)
- [å®‰è£…](#å®‰è£…)
  - [æ›´æ¢é•œåƒæº](#æ›´æ¢é•œåƒæº)
  - [å®‰è£…å¿…é¡»çš„è½¯ä»¶åŒ…](#å®‰è£…å¿…é¡»çš„è½¯ä»¶åŒ…)
- [é…ç½®ç³»ç»Ÿ](#é…ç½®ç³»ç»Ÿ)
  - [Fstab](#fstab)
  - [Chroot](#chroot)
  - [æ—¶åŒº](#æ—¶åŒº)
  - [æœ¬åœ°åŒ–](#æœ¬åœ°åŒ–)
  - [è®¾ç½®è®¡ç®—æœºå](#è®¾ç½®è®¡ç®—æœºå)
  - [Initramfs](#initramfs)
  - [è®¾ç½® Root å¯†ç ](#è®¾ç½®-root-å¯†ç )
  - [å®‰è£…å¼•å¯¼ç¨‹åº](#å®‰è£…å¼•å¯¼ç¨‹åº)
  - [é‡å¯è¿›å…¥å®‰è£…å¥½äº†çš„ Arch Linux](#é‡å¯è¿›å…¥å®‰è£…å¥½äº†çš„-arch-linux)
- [å®‰è£…åçš„å·¥ä½œ](#å®‰è£…åçš„å·¥ä½œ)
  - [è”ç½‘](#è”ç½‘)
  - [æ·»åŠ  archlinuxcn æº](#æ·»åŠ -archlinuxcn-æº)
  - [æ–°å»ºç”¨æˆ·](#æ–°å»ºç”¨æˆ·)
  - [å›¾å½¢ç•Œé¢](#å›¾å½¢ç•Œé¢)
    - [æ˜¾ç¤ºæœåŠ¡ (Display Server)](#æ˜¾ç¤ºæœåŠ¡-display-server)
  - [æ˜¾ç¤ºé©±åŠ¨ï¼ˆDisplay driversï¼‰](#æ˜¾ç¤ºé©±åŠ¨display-drivers)
    - [æ¡Œé¢ç¯å¢ƒï¼ˆDesktop Environmentï¼ŒDEï¼‰+ çª—å£ç®¡ç†å™¨ï¼ˆWindow Manager, WMï¼‰](#æ¡Œé¢ç¯å¢ƒdesktop-environmentde-çª—å£ç®¡ç†å™¨window-manager-wm)
    - [æ˜¾ç¤ºç®¡ç†å™¨ï¼ˆDisplay managerï¼‰](#æ˜¾ç¤ºç®¡ç†å™¨display-manager)
  - [Btrfs å¿«ç…§](#btrfs-å¿«ç…§)
  - [zram](#zram)
  - [å­—ä½“](#å­—ä½“)
    - [å¾®è½¯å­—ä½“](#å¾®è½¯å­—ä½“)
  - [è¾“å…¥æ³•](#è¾“å…¥æ³•)
  - [ä»£ç†](#ä»£ç†)
  - [AUR - Arch ç”¨æˆ·è½¯ä»¶æº](#aur---arch-ç”¨æˆ·è½¯ä»¶æº)
  - [å¸¸ç”¨è½¯ä»¶](#å¸¸ç”¨è½¯ä»¶)
  - [zsh](#zsh)
  - [å¼€å‘ç¯å¢ƒ](#å¼€å‘ç¯å¢ƒ)
  - [ç¾åŒ–](#ç¾åŒ–)
- [å…¶ä»–](#å…¶ä»–)
  - [kwallet](#kwallet)
  - [è°ƒæ•´é¼ æ ‡æ»šè½®é€Ÿåº¦](#è°ƒæ•´é¼ æ ‡æ»šè½®é€Ÿåº¦)
  - [æ˜¾ç¤ºå™¨äº®åº¦](#æ˜¾ç¤ºå™¨äº®åº¦)
  - [æ›´æ¢å†…æ ¸](#æ›´æ¢å†…æ ¸)
  - [æ ¡å›­ç½‘](#æ ¡å›­ç½‘)
- [Tips \& Tricks](#tips--tricks)
- [Dotfiles ç®¡ç†](#dotfiles-ç®¡ç†)
- [ç³»ç»Ÿç»´æŠ¤](#ç³»ç»Ÿç»´æŠ¤)
- [å¸¸è§é—®é¢˜æ’é™¤ä¸è§£å†³](#å¸¸è§é—®é¢˜æ’é™¤ä¸è§£å†³)
- [è®¾å¤‡](#è®¾å¤‡)
  - [è“ç‰™](#è“ç‰™)
  - [é¼ æ ‡å®](#é¼ æ ‡å®)
- [å…¶ä»–](#å…¶ä»–-1)
  - [systemd based initial ramdisk](#systemd-based-initial-ramdisk)

## æ³¨æ„

- å…³äº ntfs3
  - ä» linux 5.15 å¼€å§‹ï¼Œç”± Paragon å¼€å‘çš„ NTFS3 é©±åŠ¨å¹¶å…¥äº†å†…æ ¸ï¼Œå¦‚æœå†…æ ¸ç‰ˆæœ¬åœ¨æ­¤ä¹‹å‰ï¼Œå¯ä»¥ä½¿ç”¨ ntfs-3gï¼ˆåŸºäº FUSEï¼Œæ€§èƒ½å¾ˆæ‹‰ï¼‰ï¼Œ[åœ¨ macos ä¸Šçš„æ€§èƒ½å¯¹æ¯”](https://maxim-saplin.github.io/cpdt_results/?selected=43%2C44)ã€‚å¦‚æœæƒ³æå‰ä½“éªŒï¼Œå¯ä»¥é€šè¿‡ ntfs-dkms è½¯ä»¶åŒ…ä¸ºå½“å‰å†…æ ¸ç¼–è¯‘å®‰è£…[fs/ntfs3 æ¨¡å—](https://github.com/torvalds/linux/tree/master/fs/ntfs3)ã€‚
    ```bash
    # å»ºè®®ä» archlinuxcn è½¯ä»¶æºå®‰è£…
    sudo pacman -S ntfs3-dkms
    ```
    è®°å¾—ä¿®æ”¹ `/etc/fstab` ä¸­ä¸ ntfs3 æ–‡ä»¶ç³»ç»Ÿæœ‰å…³çš„æ¡ç›®ï¼Œæ¯”å¦‚ä¿®æ”¹ä¸º `/dev/nvme1n1p4 /mnt/XXX ntfs3 rw,nosuid,nodev,noatime,uid=1000,gid=1000,iocharset=utf8,prealloc 0 0`
  - 5.15 å†…æ ¸è™½ç„¶æ”¯æŒ ntfs3ï¼Œä½†æ˜¯ Paragon è¿˜æœªç»™å‡ºç›¸åº”çš„ userspace utiltiiesï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨ tuxera çš„ [ntfsprogs-ntfs3](https://aur.archlinux.org/packages/ntfsprogs-ntfs3/)ï¼ˆæä¾›äº† `/usr/bin/mount.ntfs` `/usr/bin/mkfs.ntfs` ç­‰å·¥å…·ï¼‰ç”¨äºæŒ‚è½½ã€æ ¼å¼åŒ–ç­‰æ“ä½œã€‚è§ <https://wiki.archlinux.org/title/NTFS>ã€‚è¿™æ ·ä½¿ç”¨ `mount` å‘½ä»¤è¿›è¡ŒæŒ‚è½½æ—¶ï¼Œè¯¥å‘½ä»¤ä¼š fork å¹¶ exece `/usr/bin/mount.ntfs`ï¼Œç„¶å mount syscall ä¼šä½¿ç”¨å†…æ ¸ä¸­çš„ ntfs3 æ¨¡å—è¿›è¡ŒæŒ‚è½½/è¯»å†™ã€‚
  - å¦‚æœä½ ä½¿ç”¨ ntfs-3gï¼Œä½†ä»æƒ³è¦ä½¿ç”¨å†…æ ¸ä¸­çš„ ntfs3 æ¨¡å—ï¼Œé‚£ä¹ˆä½¿ç”¨ `mount` å‘½ä»¤æ—¶è¯·æŒ‡å®š `-t ntfs3` é€‰é¡¹ã€‚å¯¹äº Dolphin æ–‡ä»¶ç®¡ç†å™¨ï¼ˆåº”è¯¥æ˜¯ç›´æ¥ä½¿ç”¨ mount ç³»ç»Ÿè°ƒç”¨ï¼Ÿï¼‰éœ€è¦ä¿®æ”¹é»˜è®¤çš„æŒ‚è½½é€‰é¡¹ï¼Œè§[NTFS#udisks_support - Archlinux](https://wiki.archlinux.org/title/NTFS#udisks_support)ï¼ˆä¹Ÿå¯å®‰è£… ntfsprogs-ntfs3ï¼Œè¿™ä¸ªåŒ…æä¾›äº†é…ç½®æ–‡ä»¶ï¼‰
  - `5.15.5-arch1-1` å¦‚æœ vscode æ‰“å¼€ç€ ntfs3 æ–‡ä»¶ç³»ç»Ÿé‡Œçš„æ–‡ä»¶å¤¹ï¼Œé‚£ä¹ˆæ­¤æ—¶å…³æœºçš„è¯ï¼Œä¼šå‡ºç°è¿™ç§é”™è¯¯ï¼š
    ```log
    Nov 18 15:06:45 archlinux systemd[1]: Failed unmounting /mnt/Share.
    â–‘â–‘ Subject: A stop job for unit mnt-Share.mount has finished
    â–‘â–‘ Defined-By: systemd
    â–‘â–‘ Support: https://lists.freedesktop.org/mailman/listinfo/systemd-devel
    â–‘â–‘
    â–‘â–‘ A stop job for unit mnt-Share.mount has finished.
    â–‘â–‘
    â–‘â–‘ The job identifier is 1451 and the job result is failed.
    ```

## éƒ¨åˆ†å‚è€ƒèµ„æ–™

### ArchWiki

å»ºè®®è¾¹çœ‹ ArchWiki çš„è‹±æ–‡ç‰ˆæœ¬ï¼ˆä¸­æ–‡ç¿»è¯‘ä¸æ€ä¹ˆåŠæ—¶ï¼Œæœ‰è®¸å¤šå·²ç»è¿‡æ—¶çš„å†…å®¹ï¼‰è¾¹å®‰è£…ï¼Œé‡åˆ°çš„é—®é¢˜ï¼Œä¸€èˆ¬éƒ½èƒ½åœ¨ ArchWiki æ‰¾åˆ°ç­”æ¡ˆã€‚

- [Installation guide (ç®€ä½“ä¸­æ–‡) - ArchWiki](<https://wiki.archlinux.org/index.php/Installation_guide_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)>)
- [General recommendations (ç®€ä½“ä¸­æ–‡) - ArchWiki](<https://wiki.archlinux.org/index.php/General_recommendations_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)>)
- [List of applications (ç®€ä½“ä¸­æ–‡) - ArchWiki](<https://wiki.archlinux.org/index.php/List_of_applications_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)>)

å…¶ä»–çš„ä¸€äº›å¾ˆä¸é”™çš„æ•™ç¨‹ï¼Œå¯ä»¥ä¸æœ¬æ•™ç¨‹å¯¹ç…§ç€çœ‹

- [Arch Linux å®‰è£…ä½¿ç”¨æ•™ç¨‹](https://archlinuxstudio.github.io/ArchLinuxTutorial/#/)
- [archlinux ç®€æ˜æŒ‡å—](https://arch.icekylin.online/)
  - [åºç«  | archlinux ç®€æ˜æŒ‡å—](https://arch.icekylin.online/guide/)
  - [å¸¸ç”¨è½¯ä»¶ | archlinux ç®€æ˜æŒ‡å—](https://arch.icekylin.online/app/common/daily.html)

## å®‰è£…å‰çš„å‡†å¤‡

1. ä»[SJTU é•œåƒç«™](https://mirror.sjtu.edu.cn/archlinux/iso/latest/)ä¸‹è½½ `archlinux-ç‰ˆæœ¬æ—¥æœŸ-x86_64.iso` é•œåƒæ–‡ä»¶åˆ°ä½ çš„ç”µè„‘ä¸Šï¼ˆ[å…¶ä»–çš„é•œåƒç«™](https://archlinux.org/download/#:~:text=China,edu.cn)ï¼‰
2. å‡†å¤‡ä¸€ä¸ª 1G å¤§å°ä»¥ä¸Š U ç›˜ï¼ˆå®¹é‡æ¯” archlinux çš„é•œåƒæ–‡ä»¶å¤§å°±è¡Œï¼Œå¦‚æœæ²¡ U ç›˜ï¼Œå¯ä»¥è¯•è¯•åœ¨å·²è·å– Root æƒé™çš„æ‰‹æœºä¸Šç”¨ DriveDroid æ¨¡æ‹Ÿ U ç›˜ï¼‰
3. å°† [ventoy](https://www.ventoy.net/cn/doc_start.html) å®‰è£…è¿› U ç›˜ï¼ˆåˆ†åŒºç±»å‹é€‰æ‹© GPTï¼‰ã€‚æ³¨æ„åªæœ‰ç¬¬ä¸€æ¬¡å®‰è£…éœ€è¦æ ¼å¼åŒ–ã€‚å®‰è£…å®Œæˆä¹‹åï¼ŒU ç›˜ä¼šè¢«åˆ†æˆä¸¤ä¸ªåˆ†åŒºï¼Œå°† ArchLinux ISO æ–‡ä»¶å¤åˆ¶è‡³ U ç›˜çš„ç¬¬ä¸€ä¸ªåˆ†åŒºï¼ˆå®¹é‡å¤§çš„é‚£ä¸ªï¼‰å³å¯ï¼ŒVentoy é»˜è®¤ä¼šéå†è¯¥åˆ†åŒºä¸‹æ‰€æœ‰çš„ç›®å½•å’Œå­ç›®å½•ï¼Œæ‰¾å‡ºæ‰€æœ‰çš„é•œåƒæ–‡ä»¶ï¼Œå¹¶æŒ‰ç…§å­—æ¯æ’åºä¹‹åæ˜¾ç¤ºåœ¨èœå•ä¸­ã€‚
4. ä½¿ç”¨ Windows/Linux çš„ç£ç›˜ç®¡ç†å·¥å…·åˆ†å‡ºä¸€å—**æœªåˆ†é…**çš„åŒºåŸŸä¾›æˆ‘ä»¬è¦å®‰è£…çš„ ArchLinux ä½¿ç”¨
5. å¦‚æœä½ çš„ç”µè„‘ä¸Šæœ‰ Windowsï¼Œé‚£ä¹ˆè¯·åŠ¡å¿…**ç¦ç”¨ Windows çš„å¿«é€Ÿå¯åŠ¨**ï¼Œå¦åˆ™å¯èƒ½ä¼šæ— æ³•è®¿é—® Windows ç³»ç»Ÿæ‰€åœ¨çš„åˆ†åŒºã€‚æ§åˆ¶é¢æ¿->ç¡¬ä»¶å’Œå£°éŸ³->ç”µæºé€‰é¡¹ï¼Œç‚¹å‡»`æ›´æ”¹å½“å‰ä¸å¯ç”¨çš„è®¾ç½®`ï¼Œç„¶åå–æ¶ˆå‹¾é€‰`å¯ç”¨å¿«é€Ÿå¯åŠ¨`ï¼Œä¿å­˜ä¿®æ”¹ã€‚

### å¯åŠ¨åˆ° Live ç¯å¢ƒ

1. U ç›˜æ’åœ¨ç”µè„‘ä¸Šï¼Œåœ¨é”®ç›˜äº®èµ·/å±å¹•å¾®äº®/å¿«è¦æ˜¾ç¤ºå‡ºå“ç‰Œå›¾æ ‡æ—¶ï¼Œï¼ˆå¦‚æœä½ ä¹‹å‰æ²¡æœ‰å…³é—­è¿‡ secure bootï¼Œè¯·æŒ‰ F2 è¿›å…¥ BIOS è®¾ç½®ç•Œé¢ï¼Œå°† secure boot ç¦ç”¨å†æ¥è¿›è¡Œè¿™ä¸€æ­¥ï¼‰æŒ‰ F12ï¼ˆæœ‰äº›ç”µè„‘æ˜¯ F10ï¼Œå»ºè®®è‡ªå·±æŸ¥ä¸€ä¸‹ï¼‰è¿›å…¥å¯åŠ¨é¡ºåºé€‰æ‹©ç•Œé¢ï¼Œç„¶åé€‰æ‹©ä½ çš„ USBã€‚
2. å½“ Arch èœå•å‡ºç°æ—¶ï¼Œé€‰æ‹© _Arch Linux install medium (x86_64, UEFI)_ å¹¶æŒ‰ Enter è¿›å…¥å®‰è£…ç¯å¢ƒã€‚
3. ç­‰å‡ åˆ†é’Ÿåå°±ä¼šä»¥ root èº«ä»½ç™»å½•è¿›ä¸€ä¸ªæ˜¾ç¤º`root@archiso ~ # `å­—æ ·çš„è™šæ‹Ÿæ§åˆ¶å°

### éªŒè¯å¯åŠ¨æ¨¡å¼

ç”¨ä¸‹åˆ—å‘½ä»¤åˆ—å‡º efivars ç›®å½•ï¼š

```bash
ls -d /sys/firmware/efi/efivars
```

å¦‚æœæ˜¾ç¤º `/sys/firmware/efi/efivars`ï¼Œåˆ™è¯´æ˜ç³»ç»Ÿä»¥ UEFI æ¨¡å¼å¯åŠ¨ã€‚å¦‚æœæç¤º `ls: cannot access '/sys/firmware/efi/efivars': No such file or directory`ï¼Œåˆ™è¯´æ˜ç³»ç»Ÿå¯èƒ½ä»¥ BIOS æˆ– CSM æ¨¡å¼å¯åŠ¨ï¼Œè‡ªå·±ç™¾åº¦æ€ä¹ˆæ”¹ä¸º UEFI å§

### è¿æ¥åˆ°å› ç‰¹ç½‘

- å¦‚æœæ˜¯æœ‰çº¿ç½‘ç»œ
  - ç›´æ¥ `ping baidu.com -c 4` æ¥åˆ¤æ–­ç½‘ç»œæ˜¯å¦è¿æ¥æ­£å¸¸ã€‚
- å¦‚æœæ˜¯æ— çº¿ç½‘ç»œ
  - æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆè¯¦è§[iwctl - ArchWiki](<https://wiki.archlinux.org/index.php/Iwd_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#iwctl>)ï¼‰
    ```bash
    # è¿›å…¥äº¤äº’å¼æç¤ºç¬¦ç¯å¢ƒ
    iwctl
    # æ¥ä¸‹æ¥æ˜¯åœ¨ä»¥ [iwd] å¼€å¤´çš„æç¤ºç¬¦ç¯å¢ƒä¸­è¿›è¡Œçš„
    # åˆ—å‡ºæ‰€æœ‰ WiFi è®¾å¤‡
    device list
    # å‡è®¾åˆšæ‰çš„ Name ä¸€åˆ—çš„ç½‘ç»œè®¾å¤‡åç§°ä¸º wlan0ï¼Œæ¥ä¸‹æ¥æ‰«æç½‘ç»œ
    station wlan0 scan
    # åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ç½‘ç»œ
    station wlan0 get-networks
    # å‡è®¾æƒ³è¦è¿åˆ° Network name ä¸€åˆ—ä¸­ï¼Œåç§°ä¸º Xiaomi çš„ç½‘ç»œ
    station wlan0 connect Xiaomi
    # ç„¶åæŒ‰ç…§æç¤ºè¾“å…¥å¯†ç å³å¯
    # ctlrl d é€€å‡º
    ```

### æ›´æ–°ç³»ç»Ÿæ—¶é—´

```bash
# å¯ç”¨ NTP æ—¶é—´åŒæ­¥
timedatectl set-ntp true
# æŸ¥çœ‹ NTP æœåŠ¡çŠ¶æ€
timedatectl timesync-status
```

### å»ºç«‹ç¡¬ç›˜åˆ†åŒº

æ¯ä¸ªç¡¬ç›˜éƒ½è¢«ä¼šè¢«åˆ†é…ä¸ºä¸€ä¸ªå—è®¾å¤‡ï¼Œå¦‚ `/dev/sda`ã€`/dev/sdb`ã€`/dev/sdc`ã€`/dev/nvme0n1`ã€‚å¯ä»¥ä½¿ç”¨ fdisk æŸ¥çœ‹ï¼š

```bash
fdisk -l
```

å¦‚æœæƒ³åœ¨ç¡¬ç›˜ `/dev/sda` ä¸Šè¿›è¡Œåˆ†åŒºï¼Œåˆ™è¿è¡Œï¼š

```bash
cfdisk /dev/sda
```

æŒ‰ä¸Šä¸‹é”®é€‰æ‹©æƒ³è¦æ“ä½œçš„åˆ†åŒºï¼Œç§»åŠ¨åˆ°ç»¿è‰²çš„ç©ºé—²åˆ†åŒºã€‚ç„¶åæŒ‰å·¦å³é”®é€‰æ‹©æ‰€è¦è¿›è¡Œçš„æ“ä½œï¼Œé€‰æ‹© `[ New ]`ï¼Œç„¶åå›è½¦ï¼Œè¾“å…¥æƒ³è¦åˆ†é…çš„å¤§å°ï¼Œç„¶åå†ç¡®è®¤ï¼Œå†æŒ‰å·¦å³é”®é€‰æ‹© `[ Type ]`ï¼Œç„¶åå›è½¦ï¼Œæ¥è®¾ç½®è¯¥åˆ†åŒºçš„ç±»å‹ã€‚

ä»¥æˆ‘çš„åˆ†åŒºä¸ºä¾‹ï¼ˆæ²¡å¼„ swapï¼Œè€Œæ˜¯ä½¿ç”¨æ€§èƒ½æ›´å¥½çš„ zramï¼Œåé¢ä¼šæåˆ°ï¼‰ï¼š

|  æŒ‚è½½ç‚¹   | å‡è®¾çš„è®¾å¤‡æ–‡ä»¶ |      åˆ†åŒºç±»å‹       |      å¤§å°      |
| :-------: | :------------: | :-----------------: | :------------: |
| /mnt/boot |   /dev/sda1    |     EFI System      | 500Mï¼ˆè¶³å¤Ÿäº†ï¼‰ |
|   /mnt    |   /dev/sda2    | Linux root (x86-64) |                |

ä¹Ÿæœ‰äººå°†`/mnt/boot`æ¢æˆ`/mnt/efi`æˆ–`/mnt/boot/efi`ï¼Œå…¶å®è¿™ä¸ªéšæ„ï¼Œä¸è¿‡æœ€å¥½è¿˜æ˜¯`/mnt/boot`ã€‚åˆ†å®Œåï¼ŒæŒ‰å·¦å³é”®é€‰æ‹©`[ Write ]`å›è½¦ï¼Œå† yesï¼Œä½¿ä¿®æ”¹ç”Ÿæ•ˆï¼Œå†æŒ‰ q é€€å‡º cfdisk ç•Œé¢ã€‚

æ³¨æ„ï¼šEFI åˆ†åŒºåˆ«å¼€å¯ `NoBlockIOProtocol` æ ‡å¿—ï¼Œå¦‚æœæœ‰é‚£ä¹ˆ UEFI å›ºä»¶ä¼šå¿½ç•¥è¯¥åˆ†åŒºã€‚å¯ä»¥é€šè¿‡ `fdisk /dev/sda`ï¼ˆ`m` æ˜¾ç¤ºèœå•ï¼‰ç„¶åæŒ‰ `x` è¿›å…¥ä¸“å®¶æ¨¡å¼ï¼Œå†æŒ‰ `B` å¹¶é€‰æ‹©åˆ†åŒºå·ï¼Œæ¥å¼€å¯/å…³é—­è¯¥æ ‡å¿—ï¼Œè®°å¾—æŒ‰ `r` è¿”å›ä¸»èœå•ï¼ŒæŒ‰ `w` ä¿å­˜æ›´æ”¹å¹¶é€€å‡ºã€‚

### æ ¼å¼åŒ–åˆ†åŒº

è¿™é‡Œçš„ `/dev/sda1` ç­‰ç­‰è¯·æ¢æˆä½ è‡ªå·±çš„

```bash
# å°† EFI System åˆ†åŒºæ ¼å¼åŒ–ä¸º fat32ï¼ˆUEFI æ ‡å‡†è§„å®šäº†åªæ”¯æŒ fatfsï¼‰
mkfs.fat -F32 /dev/sda1
# æ ¼å¼åŒ–ä¸º btrfs
mkfs.btrfs -L btrfs-arch /dev/sda2
```

### æŒ‚è½½åˆ†åŒº

- [Btrfs (ç®€ä½“ä¸­æ–‡) - ArchWiki](<https://wiki.archlinux.org/index.php/Btrfs_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)>)
- [mkfs.btrfs(8)](https://man.archlinux.org/man/mkfs.btrfs.8)
- [btrfs(5)](https://man.archlinux.org/man/btrfs.5) å…³äº BTRFS æ–‡ä»¶ç³»ç»Ÿçš„ä¸»é¢˜(æŒ‚è½½é€‰é¡¹ã€æ”¯æŒçš„æ–‡ä»¶å±æ€§ç­‰)
- [btrfs.wiki](https://btrfs.wiki.kernel.org/index.php/SysadminGuide)
- [compress å‚æ•° benchmark](https://docs.google.com/spreadsheets/d/1x9-3OQF4ev1fOCrYuYWt1QmxYRmPilw_nLik5H_2_qA/edit#gid=0)

btrfs çš„ä¸€äº›æŒ‚è½½é€‰é¡¹ï¼š

- `autodefrag, noautodefrag`ã€‚è‡ªåŠ¨ç¢ç‰‡æ•´ç†ï¼Œé»˜è®¤å…³é—­
- `compress, compress=type[:level], compress-force, compress-force=type[:level]`æ§åˆ¶ BTRFS æ–‡ä»¶æ•°æ®å‹ç¼©ã€‚Type å¯ä»¥æŒ‡å®šä¸º zlibã€lzoã€zstd æˆ– noï¼Œé»˜è®¤ zlib
- `discard, discard=sync, discard=async, nodiscard` å¯ç”¨ä¸¢å¼ƒå·²é‡Šæ”¾çš„æ–‡ä»¶å—ã€‚è¿™å¯¹äº SSD è®¾å¤‡ã€ç²¾ç®€é…ç»™çš„ LUNs æˆ–è™šæ‹Ÿæœºæ˜ åƒå¾ˆæœ‰ç”¨ï¼›ç„¶è€Œï¼Œæ¯ä¸ªå­˜å‚¨å±‚å¿…é¡»æ”¯æŒ discard æ‰èƒ½å·¥ä½œã€‚æ³¨æ„å†…æ ¸ 5.6 ä»¥åæ‰æ”¯æŒ asyncã€‚é»˜è®¤å…³é—­ï¼Œå¦‚æœå¯ç”¨ï¼Œå»ºè®® async
- `ssd, ssd_spread, nossd, nossd_spread` æ§åˆ¶ SSD åˆ†é…æ–¹æ¡ˆçš„é€‰é¡¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒBTRFS å°†å¯ç”¨æˆ–ç¦ç”¨ SSD ä¼˜åŒ–ï¼Œè¿™å–å†³äºè®¾å¤‡çš„æ—‹è½¬æˆ–éæ—‹è½¬ç±»å‹çš„çŠ¶æ€ã€‚é»˜è®¤ä¼šè‡ªåŠ¨æ£€æµ‹ SSDã€‚
- é€šç”¨æŒ‚è½½é€‰é¡¹ `noatime` åœ¨è¯»å–å¯†é›†çš„å·¥ä½œè´Ÿè½½ä¸‹ï¼ŒæŒ‡å®š noatime å¯ä»¥æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºä¸éœ€è¦å†™å…¥æ–°çš„è®¿é—®æ—¶é—´ä¿¡æ¯ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªé€‰é¡¹ï¼Œé»˜è®¤å€¼æ˜¯ relatimeï¼Œä¸ä¼ ç»Ÿçš„ strictatime ç›¸æ¯”ï¼Œå®ƒåªå‡å°‘äº† inode atime æ›´æ–°çš„æ•°é‡ã€‚å¦å¤–ï¼Œnoatime å·²ç»åŒ…å«äº† nodiratimeã€‚ä¸éœ€è¦åŒæ—¶æŒ‡å®šã€‚

```sh
# å…ˆæŒ‚è½½è¯¥åˆ†åŒº
mount -o compress=zstd /dev/sda2 /mnt
# ç„¶ååœ¨è¯¥åˆ†åŒºä¸­åˆ›å»ºå­å·ï¼ˆåŒæ—¶ä¹Ÿä¼šåœ¨è¯¥æ–‡ä»¶ç³»ç»Ÿåˆ›å»º @ å’Œ @home è¿™ä¸¤ä¸ªç›®å½•ï¼‰
btrfs subvolume create /mnt/@      # åˆ›å»ºå­å· @
btrfs subvolume create /mnt/@home  # åˆ›å»ºå­å· @home
# å¸è½½
umount /mnt

# å°† btrfs åˆ†åŒºçš„ @ å­å·æŒ‚è½½åˆ° /mnt
mount -o noatime,compress=zstd,subvol=@     /dev/sda2 /mnt
# å°† btrfs åˆ†åŒºçš„ @home å­å·æŒ‚è½½åˆ° /mnt/home
mkdir /mnt/home
mount -o noatime,compress=zstd,subvol=@home /dev/sda2 /mnt/home
```

```bash
# æŒ‚è½½ EFI System åˆ†åŒº
mkdir /mnt/boot
mount /dev/sda1 /mnt/boot
```

## å®‰è£…

### æ›´æ¢é•œåƒæº

```bash
# ä¿®æ”¹è½¯ä»¶æº
echo 'Server = https://mirror.sjtu.edu.cn/archlinux/$repo/os/$arch' > /etc/pacman.d/mirrorlist
# ä¹Ÿå¯ä½¿ç”¨ reflector è·å–å›½å†…çš„ https è½¯ä»¶æºï¼Œå¹¶ä¸”æŒ‰ä¸‹è½½é€Ÿåº¦è¿›è¡Œæ’åºï¼Œå¹¶ä¿å­˜åˆ° /etc/pacman.d/mirrorlist ä¸­
# reflector -c China > /etc/pacman.d/mirrorlist
# æ›´æ–°è½¯ä»¶åŒ…æ•°æ®åº“
pacman -Syy
```

å…¶ä»–é•œåƒæºè¯·è§é€šè¿‡ [Pacman Mirrorlist ç”Ÿæˆå™¨](https://www.archlinux.org/mirrorlist/)ç”Ÿæˆçš„[å›½å†…æºåˆ—è¡¨](https://www.archlinux.org/mirrorlist/?country=CN&protocol=http&protocol=https&ip_version=4)ï¼Œç”¨è‡ªå·±å­¦æ ¡çš„æ›´å¿«å“¦ï¼

### å®‰è£…å¿…é¡»çš„è½¯ä»¶åŒ…

ä½¿ç”¨ pacstrap è„šæœ¬ï¼Œå®‰è£… base è½¯ä»¶åŒ…å’Œ Linux å†…æ ¸ä»¥åŠå¸¸è§„ç¡¬ä»¶çš„å›ºä»¶ç­‰ç­‰ï¼š

```bash
# å®‰è£…åŸºæœ¬çš„è½¯ä»¶ã€‚æ³¨æ„ï¼šä¸€å®šè¦åœ¨ linux è½¯ä»¶åŒ…å®‰è£…ä¹‹é—´å…ˆæŠŠ base è½¯ä»¶åŒ…å®‰è£…å¥½ï¼ŒåŸå› åé¢ä¼šè®²
pacstrap /mnt --needed base base-devel
# å®‰è£… Linux å†…æ ¸ä»¥åŠå¸¸è§„ç¡¬ä»¶çš„å›ºä»¶
pacstrap /mnt --needed linux linux-firmware
# å®‰è£…ç¼–è¾‘å™¨ã€ç½‘ç»œç®¡ç†å™¨ï¼ˆè‹¥ä¸å®‰è£…åé¢å°±ä¼šæœ‰è¿ä¸ä¸Šç½‘ç»œçš„éº»çƒ¦ï¼‰ã€ä¸€äº›æœ‰ç”¨çš„è„šæœ¬ã€btrfs å·¥å…·
pacstrap /mnt --needed neovim networkmanager arch-install-scripts btrfs-progs
```

## é…ç½®ç³»ç»Ÿ

### Fstab

ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆ fstab æ–‡ä»¶ (`-U` æˆ– `-L` é€‰é¡¹ä½¿ç”¨ UUID æˆ–å·æ ‡)ï¼š

```bash
# æ£€æŸ¥ä¸€ä¸‹ç”Ÿæˆçš„ fstab æ˜¯å¦æ­£ç¡®
genfstab -L /mnt
# å¦‚æœæ­£ç¡®å°±å°†å…¶è¿½åŠ è¿› /mnt/etc/fstab
# æ³¨ï¼šå»ºè®® EFI åˆ†åŒºä½¿ç”¨ UUIDï¼Œå› ä¸ºæœ‰æ—¶å€™åŠ è£…æ–°ç¡¬ç›˜å¯èƒ½ä¼šå¯¼è‡´å—è®¾å¤‡åå‘ç”Ÿå˜åŒ–
genfstab -L /mnt >> /mnt/etc/fstab
```

### Chroot

åˆ‡æ¢åˆ°æˆ‘ä»¬æ–°å®‰è£…çš„ç³»ç»Ÿï¼Œæ‰§è¡Œäº†è¿™æ­¥ä»¥åï¼Œæˆ‘ä»¬çš„æ“ä½œéƒ½ç›¸å½“äºåœ¨ç¡¬ç›˜ä¸Šæ–°è£…çš„ç³»ç»Ÿä¸­è¿›è¡Œ

```bash
arch-chroot /mnt
```

### æ—¶åŒº

```bash
# è®¾ç½®æ—¶åŒºä¸ºä¸Šæµ·
timedatectl set-timezone Asia/Shanghai
# æŸ¥çœ‹æ—¶é—´
date -R
# å°†ç¡¬ä»¶æ—¶é’Ÿï¼ˆRTCï¼‰è°ƒæ•´ä¸ºä¸ç›®å‰çš„ç³»ç»Ÿæ—¶é’Ÿä¸€è‡´
hwclock --systohc
```

### æœ¬åœ°åŒ–

```bash
# å…ˆå¼„ä¸ªè½¯é“¾æ¥
ln -s /usr/bin/nvim /usr/bin/vim
ln -s /usr/bin/nvim /usr/bin/vi

# ç¼–è¾‘/etc/locale.genï¼Œå°† en_US.UTF-8 UTF-8 å’Œ zh_CN.UTF-8 UTF-8 å–æ¶ˆæ³¨é‡Š
vim /etc/locale.gen
# ç”Ÿæˆ locale ä¿¡æ¯
locale-gen
# åˆ›å»º locale.conf æ–‡ä»¶ï¼Œå¹¶ç¼–è¾‘è®¾å®š LANG å˜é‡ï¼Œä¸å»ºè®®å¼„æˆä¸­æ–‡çš„ï¼Œä¼šå¯¼è‡´ tty ä¹±ç 
# è¿™æ­¥åƒä¸‡åˆ«å†™é”™ï¼ï¼ˆè¿™ä¸ªè®¾ç½®ä¼šå½±å“åˆ° ~/.config/plasma-localerc çš„å†…å®¹ï¼‰
echo 'LANG=en_US.UTF-8' > /etc/locale.conf
```

### è®¾ç½®è®¡ç®—æœºå

æ³¨æ„ï¼šè¿™é‡Œçš„ myhostname æ¢æˆä½ è‡ªå·±æƒ³è¦è®¾ç½®çš„ä¸»æœºå

```bash
echo 'myhostname' > /etc/hostname
# ç„¶åç¼–è¾‘ /etc/hosts
vim /etc/hosts
```

å¡«å…¥å¦‚ä¸‹å†…å®¹ä»¥é…ç½®æœ¬åœ°ä¸»æœºåçš„è§£æï¼š

```
127.0.0.1  localhost
::1        localhost
127.0.1.1  myhostname.localdomain  myhostname
```

### Initramfs

- [mkinitcpio (ç®€ä½“ä¸­æ–‡) - ArchWiki](<https://wiki.archlinux.org/index.php/Mkinitcpio_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)>)

åœ¨å‰é¢æ‰§è¡Œ `pacstrap /mnt --needed linux` å‘½ä»¤å®‰è£… `linux` è½¯ä»¶åŒ…æ—¶ï¼Œpacman ä¼šè¿è¡Œä¸€äº› hooksï¼Œå…¶ä¸­å°±åŒ…æ‹¬ `/usr/share/libalpm/hooks/90-mkinitcpio-install.hook`ï¼Œå®ƒä¼šæ‰§è¡Œ `/usr/share/libalpm/scripts/mkinitcpio install` å‘½ä»¤ï¼Œç”Ÿæˆ `/etc/mkinitcpio.d/linux.preset` æ–‡ä»¶ï¼Œå¹¶ä¸”ç”Ÿæˆä¸¤ä¸ª initial ramdisk imagesï¼š

```bash
â¯ ls /boot/initramfs*
/boot/initramfs-linux-fallback.img  /boot/initramfs-linux.img
```

å¦‚æœæ²¡æœ‰è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ™è¯´æ˜ hooks æ²¡æˆåŠŸè¿è¡Œã€‚åŸå› å¯èƒ½æ˜¯å®‰è£… linux è½¯ä»¶åŒ…ä¹‹å‰æ²¡æœ‰å®‰è£… base è½¯ä»¶åŒ…ï¼Œç¼ºå°‘äº† sed å‘½ä»¤ï¼Œå¯¼è‡´è¿è¡Œ hook æ—¶ï¼Œå…¶ä¸­çš„ä¸€æ¡å‘½ä»¤ `sed "s|%PKGBASE%|linux|g" /usr/share/mkinitcpio/hook.preset > /etc/mkinitcpio.d/linux.preset` æ²¡æœ‰è¿è¡Œã€‚æˆ‘ä»¬è¿è¡Œè¯¥å‘½ä»¤ï¼Œå°±å¯ä»¥ç”Ÿæˆç¼ºå¤±çš„ `/etc/mkinitcpio.d/linux.preset` æ–‡ä»¶äº†ã€‚
ç„¶åè¿è¡Œ `mkinitcpio -p linux` ä»¥ç”Ÿæˆ initial ramdisk imagesã€‚

æ³¨ï¼šfallback çš„ä¸€èˆ¬éƒ½ç”¨ä¸åˆ°ï¼Œæ‰€ä»¥æˆ‘ä¿®æ”¹äº† `/etc/mkinitcpio.d/linux.preset`ï¼Œæ”¹æˆäº† `PRESETS=('default')`ï¼Œåªç”Ÿæˆ `/boot/initramfs-linux.img`

### è®¾ç½® Root å¯†ç 

```bash
passwd
```

### å®‰è£…å¼•å¯¼ç¨‹åº

- [å®‰è£…å¼•å¯¼ç¨‹åº - ArchWiki](<https://wiki.archlinux.org/index.php/Installation_guide_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E5%AE%89%E8%A3%85%E5%BC%95%E5%AF%BC%E7%A8%8B%E5%BA%8F>)
- [GRUB (ç®€ä½“ä¸­æ–‡) - ArchWiki](<https://wiki.archlinux.org/index.php/GRUB_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)>)

å†…æ ¸å¯ä»¥é€šè¿‡æ›´æ–°å¯åŠ¨æ—¶çš„ _Microcode_ï¼Œå³[å¾®ç ](<https://wiki.archlinux.org/index.php/Microcode_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)>)ï¼Œæ¥ä¿®æ­£å¤„ç†å™¨çš„[é”™è¯¯è¡Œä¸º](https://www.anandtech.com/show/8376/intel-disables-tsx-instructions-erratum-found-in-haswell-haswelleep-broadwelly)ã€‚

- å¦‚æœæ˜¯ AMD CPUï¼Œéœ€å…ˆ `pacman -S amd-ucode`
- å¦‚æœæ˜¯ Intel CPUï¼Œåˆ™ `pacman -S intel-ucode`

æ¥ä¸‹æ¥å®‰è£… GRUB å¼•å¯¼ç¨‹åº

```bash
# å®‰è£… grub åŠå¯é€‰ä¾èµ–
pacman -S --needed grub efibootmgr os-prober
# éƒ¨ç½² grub
# ç”Ÿæˆ /boot/EFI/ArchLinux/grubx64.efi å¹¶å°†å…¶åŠ å…¥å¼•å¯¼æ¡ç›®
# --target=x86_64-efi å¯ä»¥çœç•¥ï¼Œå› ä¸ºè¿™æ˜¯é»˜è®¤å€¼
grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=ArchLinux
# ç”Ÿæˆ /boot/EFI/BOOT/BOOTX64.EFI å¹¶å°†å…¶åŠ å…¥å¼•å¯¼æ¡ç›®
grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=ArchLinux --removable
# æŸ¥çœ‹å¼•å¯¼æ¡ç›®åŠé¡ºåº
efibootmgr -v
# æ›´æ”¹å¼•å¯¼é¡ºåº
# efibootmgr --bootorder åºå·,åºå·,...
```

`vim /etc/default/grub`ï¼ŒæŒ‰éœ€ä¿®æ”¹ä»¥ä¸‹å‡ ä¸ªé€‰é¡¹ï¼š

```conf
# ä½¿ç”¨è®°ä½çš„å¯åŠ¨é¡¹ä¸ºé»˜è®¤å¯åŠ¨é¡¹
GRUB_DEFAULT=saved
# å¯åŠ¨æ—¶æ‰“å°æ›´å¤š log
GRUB_CMDLINE_LINUX_DEFAULT="loglevel=5"
# ä½¿ GRUB è®°ä½æœ€è¿‘ä¸€æ¬¡ä½¿ç”¨çš„å¯åŠ¨é¡¹
GRUB_SAVEDEFAULT=true
# æ”¯æŒæ£€æµ‹åŒä¸€ ESP å†…å…¶ä»–ç³»ç»Ÿçš„å¼•å¯¼ï¼Œæ¯”å¦‚ Windows
GRUB_DISABLE_OS_PROBER=false
```

XXX æ³¨æ„ï¼šå¦‚æœ esp åˆ†åŒºæ˜¯ /boot/efiï¼Œé‚£ä¹ˆåˆ«è®¾ç½® GRUB_DEFAULT å’Œ GRUB_SAVEDEFAULT ä¼šæŠ¥é”™ï¼[GRUB error: sparse file not allowed - Support - Manjaro Linux Forum](https://forum.manjaro.org/t/grub-error-sparse-file-not-allowed/20267/4) è¿™æ˜¯å› ä¸º grub æƒ³è¦å†™å…¥ /boot/grub/grubenv å› æ­¤è¦ä¹ˆæŠŠ /boot æ”¹æˆ ext æˆ– vfat æ–‡ä»¶ç³»ç»Ÿï¼Œè¦ä¹ˆå°±åˆ«ç”¨è¿™ä¸ªåŠŸèƒ½ã€‚

æœ€å `sudo grub-mkconfig -o /boot/grub/grub.cfg` æ›´æ–°é…ç½®æ–‡ä»¶ï¼Œå¦‚æœæ˜¯åŒç³»ç»Ÿï¼Œè¾“å‡ºä¸­åº”è¯¥æœ‰ `Found Windows Boot Manager ...` å­—æ ·ã€‚

æ³¨æ„ï¼š

- å¦‚æœåœ¨å®‰è£… ArchLinux ä¹‹åå†å®‰è£… Windowsï¼ŒWindows ä¼šå’Œ ArchLinux å…±ç”¨ä¸€ä¸ª EFI åˆ†åŒºï¼ŒWindows çš„å¼•å¯¼ä¸º `esp/EFI/Microsoft/Boot/bootmgfw.efi`ã€‚Windows å¤§ç‰ˆæœ¬æ›´æ–°æ—¶å¯èƒ½ä¼šç ´å ArchLinux çš„ grubï¼Œå»ºè®®æ›´æ–° Windows ä¹‹å‰å¤‡ä»½å¥½ grub æˆ–è€…å‡†å¤‡ä¸€ä¸ªå¯åŠ¨ç›˜ç”¨æ¥ä¿®å¤ã€‚
- å¦‚æœ `grub-install` ä½¿ç”¨ `--removable` é€‰é¡¹ï¼Œé‚£ GRUB è¿˜å°†è¢«å®‰è£…åˆ° `esp/EFI/BOOT/BOOTX64.EFI`ï¼ˆä¸€ä¸ª default/fallback boot pathï¼‰ï¼Œæ­¤æ—¶å³ä½¿ EFI å˜é‡è¢«é‡è®¾æˆ–è€…ä½ æŠŠè¿™ä¸ªç¡¬ç›˜æ¥åˆ°å…¶ä»–ç”µè„‘ä¸Šï¼Œè¿™ä¸ªå¯åŠ¨é¡¹ä»ä¸ä¼šè¢«ä¸¢å¤±ã€‚ï¼ˆæ‰€ä»¥å»ºè®®ä¸ºæ¯ä¸ªç³»ç»Ÿéƒ½å»ºä¸€ä¸ª esp åˆ†åŒºï¼Œå¹¶ä¸”éƒ½ä½¿ç”¨ `--removable` é€‰é¡¹ï¼Œè¿™æ ·å°†ç¡¬ç›˜è£…åˆ°æ–°ç”µè„‘ä¸Šåå°±ä¸ä¼šä¸¢å¤±å¼•å¯¼äº†ï¼‰

### é‡å¯è¿›å…¥å®‰è£…å¥½äº†çš„ Arch Linux

```bash
# é€€å‡ºæˆ‘ä»¬å®‰è£…å¥½äº†çš„ç³»ç»Ÿï¼Œå›åˆ° U ç›˜é‡Œçš„ Live ç¯å¢ƒ
exit
# é‡å¯
reboot
```

å±å¹•å¾®äº®æ—¶æŒ‰ F8/F10/F12ï¼ˆä¸åŒçš„ä¸»æ¿å¯èƒ½ä¸åŒï¼‰è¿›å…¥å¯åŠ¨é¡ºåºé€‰æ‹©ç•Œé¢ï¼Œç„¶åé€‰æ‹© ArchLinuxï¼ˆä¹Ÿå¯æŒ‰ F2 è¿›å…¥ BIOS è®¾ç½®ç•Œé¢ï¼Œå°† ArchLinux è°ƒåˆ°ç¬¬ä¸€ä½ï¼‰

è¾“å…¥ç”¨æˆ·å rootï¼Œå›è½¦ï¼Œå†è¾“å…¥å¯†ç ï¼Œå³å¯å®Œæˆç™»å½•ï¼

## å®‰è£…åçš„å·¥ä½œ

**è¿™ä¸€éƒ¨åˆ†ä¸»è¦å‚è€ƒ [General recommendations (ç®€ä½“ä¸­æ–‡) - ArchWiki](<https://wiki.archlinux.org/index.php/General_recommendations_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)>)**

### è”ç½‘

- [Network configuration (ç®€ä½“ä¸­æ–‡) - ArchWiki](<https://wiki.archlinux.org/index.php/Network_configuration_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)>)
- [NetworkManager è‡ªå¸¦çš„ nmcli ä½¿ç”¨ç¤ºä¾‹ - ArchWiki](<https://wiki.archlinux.org/index.php/NetworkManager_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#nmcli_%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B>)

```sh
# è®¾ç½® DNS server
echo 'nameserver 223.5.5.5' > /etc/resolv.conf
# ç»™è¯¥æ–‡ä»¶è®¾ç½®å†™ä¿æŠ¤ï¼Œé˜²æ­¢å°†æ¥è¢« NetworkManager ä¿®æ”¹
chattr +i /etc/resolv.conf
# å¦‚æœä¹‹åæƒ³ä¿®æ”¹è¯¥æ–‡ä»¶ï¼Œéœ€å…ˆ chattr -i /etc/resolv.conf å»é™¤å†™ä¿æŠ¤
```

ç„¶åå¯ç”¨ NetworkManager.service systemd æœåŠ¡ï¼Œå¹¶ç”¨å…¶è‡ªå¸¦çš„ nmcli è”ç½‘ã€‚

```sh
# é¦–å…ˆéœ€è¦å¯åŠ¨ NetworkManager å®ˆæŠ¤è¿›ç¨‹
systemctl enable --now NetworkManager
# æ˜¾ç¤ºé™„è¿‘çš„ wifi
nmcli device wifi list
# è¿æ¥ WIFIï¼Œæ­¤å¤„å‡è®¾è¦è¿æ¥çš„ WIFI çš„åç§°(SSID) ä¸º MY_WIFIï¼Œå¯†ç ä¸º MY_PASSWD
nmcli device wifi connect MY_WIFI password MY_PASSWD
# æµ‹è¯•
ping baidu.com -c 4
```

### æ·»åŠ  archlinuxcn æº

- [Arch Linux ä¸­æ–‡ç¤¾åŒº](https://www.archlinuxcn.org/)
- [archlinuxcn è½¯ä»¶æºåˆ—è¡¨](https://github.com/archlinuxcn/mirrorlist-repo)

```sh
vim /etc/pacman.conf
```

- å–æ¶ˆ `#Color` çš„æ³¨é‡Šä»¥å¯ç”¨å½©è‰²è¾“å‡º
- `ParallelDownloads = 8` å¯ç”¨å¹¶è¡Œä¸‹è½½
- å–æ¶ˆ `[multilib]` ä¸¤è¡Œçš„æ³¨é‡Šä»¥å¯ç”¨ multilib åº“ã€‚ï¼ˆæˆ‘å¹³æ—¶ç”¨ä¸åˆ° 32 ä½çš„ç¨‹åºï¼Œå°±æ²¡å¼€ï¼‰
- ç„¶ååŠ  archlinuxcn æºï¼Œåœ¨æ–‡ä»¶æœ«å°¾åŠ ä¸Šä»¥ä¸‹å†…å®¹ï¼š
  ```conf
  [archlinuxcn]
  Server = https://mirrors.sjtug.sjtu.edu.cn/archlinux-cn/$arch
  Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch
  ```

```bash
# ç»™ä¸€äº›æ–‡ä»¶æ·»åŠ å†™ä¿æŠ¤ï¼Œé˜²æ­¢æ–‡ä»¶è¢«å…¶ä»–ç¨‹åºä¿®æ”¹
chattr +i /etc/pacman.d/mirrorlist

pacman -Syy archlinuxcn-keyring     # å¼ºåˆ¶æ›´æ–°è½¯ä»¶åŒ…æ•°æ®åº“ï¼Œå¹¶å®‰è£… archlinuxcn çš„ keyring
```

### æ–°å»ºç”¨æˆ·

- [Users and groups (ç®€ä½“ä¸­æ–‡) - ArchWiki](<https://wiki.archlinux.org/index.php/Users_and_groups_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)>)

æ³¨æ„ï¼šusername è¯·æ¢æˆä½ è‡ªå·±çš„ç”¨æˆ·å

```bash
# æ–°å»ºç”¨æˆ·ã€‚-m ä¸ºç”¨æˆ·åˆ›å»ºå®¶ç›®å½•ï¼›-G wheel å°†ç”¨æˆ·æ·»åŠ åˆ° wheel ç”¨æˆ·ç»„
# -s è®¾ç½®å¯åŠ¨å‘½ä»¤
useradd -m -G wheel -s /bin/zsh username
# è®¾ç½®å¯†ç 
passwd username
```

è¿è¡Œå‘½ä»¤ `EDITOR=vim visudo` ä¿®æ”¹ `/etc/sudoers`ï¼Œå°†ä»¥ä¸‹ä¸¤è¡Œè¡Œé¦–çš„`# `å»æ‰ã€‚ä½œç”¨åˆ†åˆ«æ˜¯ç»™ wheel ç”¨æˆ·ç»„çš„ç”¨æˆ·æ·»åŠ  sudo å‘½ä»¤æƒé™å¹¶ä¸” sudo æ—¶æ— éœ€è¾“å…¥å¯†ç ã€‚

```bash
# %wheel ALL=(ALL) ALL
# %wheel ALL=(ALL) NOPASSWD: ALL
```

### å›¾å½¢ç•Œé¢

#### æ˜¾ç¤ºæœåŠ¡ (Display Server)

- [Xorg - ArchWiki](https://wiki.archlinux.org/title/Xorg)
- [Wayland - ArchWiki](https://wiki.archlinux.org/title/Wayland#Compositors)

display server é€šè¿‡ display server protocol å’Œ client (application) è¿›è¡Œé€šä¿¡ï¼ˆå‘é€é¼ æ ‡ç§»åŠ¨ã€ç‚¹å‡»ç­‰è¾“å…¥äº‹ä»¶ï¼‰

æœ‰ä¸¤ç§å¸¸ç”¨çš„ display server protocolï¼š

- X Window System(X11)ã€‚X Window System æ˜¯åŸºäºç½‘ç»œçš„ display server protocolï¼Œæä¾›äº†çª—å£åŠŸèƒ½ï¼ŒåŒ…å«å»ºç«‹å›¾å½¢ç”¨æˆ·ç•Œé¢(GUI)çš„æ ‡å‡†å·¥å…·å’Œåè®®ã€‚Xorg æ˜¯ä¸€ä¸ªä½¿ç”¨äº† X11 protocol çš„ display server å®ç°ã€‚
  ```bash
  # åªå®‰è£… xorg-server å³å¯
  # å¯é€‰ï¼šxorg è½¯ä»¶åŒ…ç»„ï¼ŒåŒ…å« xorg-serverï¼Œä»¥åŠ xorg-apps xorg-fonts ç»„ä¸­çš„è½¯ä»¶åŒ…
  pacman -S --needed xorg-server
  ```
- ï¼ˆ**æ¨è**ï¼‰Wayland æ˜¯ä¸€ä¸ªæ–°çš„ display server protocolã€‚ä½¿ç”¨ Wayland protocol çš„ display server å«åš compositorsï¼ˆå› ä¸ºå®ƒä»¬è¿˜å……å½“ compositing window managersï¼‰ï¼Œæ”¯æŒ Wayland protocol çš„ compositors è§ [Wayland#Compositors](https://wiki.archlinux.org/title/Wayland#Compositors)ã€‚Xwayland åˆ™æä¾›äº†ä¸€ä¸ªå…¼å®¹å±‚ï¼Œä»¥æ— ç¼è¿è¡ŒåŸç”Ÿ X11 åº”ç”¨ç¨‹åºã€‚
  compositing window managers ä¼šåœ¨åé¢å®‰è£…æ¡Œé¢ç¯å¢ƒæ—¶è¢«å®‰è£…å¥½ã€‚

### æ˜¾ç¤ºé©±åŠ¨ï¼ˆDisplay driversï¼‰

- [Xorg#Driver_installation - ArchWiki](https://wiki.archlinux.org/title/Xorg#Driver_installation)
- [archlinux æ˜¾å¡é©±åŠ¨ | archlinux ç®€æ˜æŒ‡å—](https://arch.icekylin.online/guide/rookie/graphic-driver.html)

åœ¨ linux ä¸Šï¼Œå»ºè®®ç›´æ¥å½»åº•ä¸ç”¨ nvidia æ˜¾å¡ã€‚

ç¦ç”¨ nouveauï¼Œå†™é…ç½®æ–‡ä»¶ï¼Œç„¶å `sudo mkinitcpio -P`ã€‚é‡å¯åï¼Œlspci ä¼šçœ‹åˆ°æ²¡æœ‰ Kernel driver in use: nouveau äº†ï¼Œåªå‰©ä¸‹ Kernel modules: nouveauã€‚è¿™è¯´æ˜ nouveau é©±åŠ¨æ²¡æœ‰ä¸æ˜¾å¡è®¾å¤‡ç»‘å®šã€‚è¿™ä¸¤ä¸ªçš„åŒºåˆ«è§ https://unix.stackexchange.com/a/47240

```conf
# https://askubuntu.com/a/951892
# /etc/modprobe.d/blacklist-nouveau.conf
blacklist nouveau
options nouveau modeset=0
```

å…ˆä½¿ç”¨ `lspci | grep -e VGA -e 3D` å‘½ä»¤ä»¥æŸ¥çœ‹æ˜¾å¡ç±»å‹ã€‚

- NVIDIA
  ```bash
  # è¿™ä¸ªæ˜¯é—­æºçš„
  # å¼€æºçš„æ˜¯ nvidia-open https://github.com/NVIDIA/open-gpu-kernel-modules ä¸æ€ä¹ˆç¨³å®š
  pacman -S nvidia
  pacman -S nvidia-settings lib32-nvidia-utils
  ```
  æ³¨ï¼šnvidia-utils è½¯ä»¶åŒ…é‡Œçš„ `/usr/lib/modprobe.d/nvidia-utils.conf` ç¦ç”¨äº† nouveauã€‚ï¼ˆå»ºè®®å†åŠ ä¸Š `options nouveau modeset=0` å‚è€ƒ https://askubuntu.com/a/951892ï¼‰
  å¦å¤–è¯·ç¼–è¾‘ `/etc/mkinitcpio.conf`ï¼Œåœ¨ HOOKS ä¸€è¡Œåˆ é™¤ `kms` å¹¶ä¿å­˜ï¼Œç„¶åæ‰§è¡Œ `mkinitcpio -P` é‡æ–°ç”Ÿæˆä¸€æ¬¡é•œåƒã€‚è¿™èƒ½é˜²æ­¢ initramfs åŒ…å« nouveau æ¨¡å—ï¼Œé¿å… åœ¨ early boot æ—¶ nouveau å’Œå®˜æ–¹é©±åŠ¨çš„å†²çªã€‚ï¼ˆå¦‚æœæ²¡å®‰è£… xf86-video-nouveauï¼Œé‚£å¯ä»¥ç•¥è¿‡è¿™ä¸€æ­¥ï¼‰
- Intel
  ä¸å»ºè®®å®‰è£… `xf86-video-intel`ï¼ŒXorg ä¼š fall back åˆ° kernel mode setting é©±åŠ¨
  ```bash
  pacman -S mesa lib32-mesa vulkan-intel lib32-vulkan-intel
  ```
- å¦‚æœæ˜¯è¾ƒæ—§çš„ AMD æ˜¾å¡ï¼ˆGPU æ¶æ„ä¸º GCN2 åŠä¹‹å‰çš„ï¼Œè¯¦è§<https://wiki.archlinux.org/index.php/Xorg#AMD>ï¼‰ï¼š
  ```sh
  pacman -S mesa lib32-mesa xf86-video-ati
  ```
  å¦‚æœæ˜¯è¾ƒæ–°çš„ AMD æ˜¾å¡ï¼Œæˆ‘ç”¨çš„æ˜¯ APU 4750Gï¼ŒGPU ä»£å·ä¸º Renoirï¼Œæ ¹æ®<https://en.wikipedia.org/wiki/Radeon_RX_Vega_series#Renoir_(2020)>å¯çŸ¥ä¸º Vega 8 æ¶æ„ï¼Œä¸º GCN5ï¼Œæ•…ï¼š
  ```sh
  pacman -S mesa lib32-mesa xf86-video-amdgpu vulkan-radeon lib32-vulkan-radeon
  ```

mesa æ˜¯ OpenGL é©±åŠ¨ï¼Œvulkan æ˜¯ OpenGL çš„ç»§æ‰¿è€…ã€‚

å…¶ä»–
è™½ç„¶ xf86-input-synaptics å·²ç»ä¸å†æ›´æ–°äº†ï¼Œä½†æ˜¯ä¸€äº›æ—§ç¬”è®°æœ¬çš„è§¦æ§æ¿è¿˜æ˜¯éœ€è¦è¿™ä¸ªåŒ…çš„

#### æ¡Œé¢ç¯å¢ƒï¼ˆDesktop Environmentï¼ŒDEï¼‰+ çª—å£ç®¡ç†å™¨ï¼ˆWindow Manager, WMï¼‰

- [Desktop environment (ç®€ä½“ä¸­æ–‡) - ArchWiki](<https://wiki.archlinux.org/index.php/Desktop_environment_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)>)
- [Window manager (ç®€ä½“ä¸­æ–‡) - ArchWiki](<https://wiki.archlinux.org/index.php/Window_manager_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)>)
- [Compare Packages](https://pkgstats.archlinux.de/compare/packages#packages=cinnamon,gnome-shell,lxde-common,mate-panel,plasma-workspace,xfdesktop)
  ArchLinux å„ç§æ¡Œé¢ç¯å¢ƒä½¿ç”¨ç‡å¯¹æ¯”ï¼ŒKDE Plasma > Gnome > Xfce4

Xorg åªæä¾›å›¾å½¢ç¯å¢ƒçš„åŸºæœ¬æ¡†æ¶ï¼Œæ¡Œé¢ç¯å¢ƒåˆ™åœ¨ Xorg ä¹‹ä¸Šå¹¶ä¸å…¶å…±åŒè¿ä½œï¼Œé€šè¿‡æ±‡é›†ä½¿ç”¨ç›¸åŒç»„ä»¶åº“çš„ç¨‹åºï¼Œä¸ºç”¨æˆ·æä¾›å®Œå…¨çš„å›¾å½¢ç”¨æˆ·ç•Œé¢ã€‚

æ¡Œé¢ç¯å¢ƒå°†å„ç§ç»„ä»¶æ†ç»‘åœ¨ä¸€èµ·ï¼Œä»¥æä¾›å¸¸è§çš„å›¾å½¢ç”¨æˆ·ç•Œé¢å…ƒç´ ï¼Œå¦‚å›¾æ ‡ã€å·¥å…·æ ã€å£çº¸å’Œæ¡Œé¢å°éƒ¨ä»¶ã€‚æ­¤å¤–ï¼Œå¤§å¤šæ•°æ¡Œé¢ç¯å¢ƒåŒ…æ‹¬ä¸€å¥—é›†æˆçš„åº”ç”¨ç¨‹åºå’Œå®ç”¨ç¨‹åºã€‚æœ€é‡è¦çš„æ˜¯ï¼Œæ¡Œé¢ç¯å¢ƒæä¾›äº†ä»–ä»¬è‡ªå·±çš„çª—å£ç®¡ç†å™¨ï¼Œç„¶è€Œé€šå¸¸å¯ä»¥ç”¨å¦ä¸€ä¸ªå…¼å®¹çš„çª—å£ç®¡ç†å™¨æ¥ä»£æ›¿ã€‚

çª—å£ç®¡ç†å™¨ï¼ˆWMï¼‰æ˜¯ä¸€ç§ç³»ç»Ÿè½¯ä»¶ï¼Œåœ¨å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰ä¸­çš„çª—å£ç³»ç»Ÿä¸­æ§åˆ¶çª—å£çš„ä½ç½®å’Œå¤–è§‚ã€‚å®ƒå¯ä»¥æ˜¯æ¡Œé¢ç¯å¢ƒï¼ˆDEï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹ä½¿ç”¨ã€‚
æ³¨æ„ï¼šçª—å£ç®¡ç†å™¨æ˜¯ Xorg ç‹¬æœ‰çš„ã€‚Wayland ä¸Šçª—å£ç®¡ç†å™¨çš„ç­‰ä»·ç‰©ç§°ä¸ºæ··æˆå™¨ï¼Œå› ä¸ºå®ƒä»¬ä¹Ÿå……å½“æ··æˆçª—å£ç®¡ç†å™¨ã€‚

è¿™é‡Œåªä»‹ç»ä¸¤ç§æ¡Œé¢ç¯å¢ƒï¼Œæ ¹æ®éœ€è¦é€‰ä¸€ä¸ªå³å¯ã€‚

- KDEï¼ˆæˆ‘è§‰å¾—è¿™ä¸ªæœ€å¥½çœ‹ä¹Ÿæœ€å¥½ç”¨ï¼‰ï¼Œä½¿ç”¨ KWin ä½œä¸ºçª—å£ç®¡ç†å™¨/æ··æˆå™¨
  ```sh
  # å®‰è£… plasma æ¡Œé¢ç¯å¢ƒ
  # å»ºè®®å®‰è£…å…ƒè½¯ä»¶åŒ… plasma-meta è€Œéè½¯ä»¶åŒ…ç»„ plasma
  # è‹¥è¦ä½¿ç”¨ Plasma çš„æœ€å°å®‰è£…ï¼Œåªå®‰è£… plasma-desktop åŒ…å³å¯
  pacman -S --needed plasma-meta
  # å¯é€‰ï¼šè½¯ä»¶åŒ…ç»„ kde-applicationsï¼Œä½†æ˜¯åŒ…å«ä¸€å¤§å †æ²¡ç”¨çš„è½¯ä»¶åŒ…ç»„ï¼Œæ¯”å¦‚ï¼š
  # kde-pim kde-accessibility kde-education telepathy-kde
  # å¦å¤–ï¼Œè‹¥è¦åœ¨ plasma ä¸­æ”¯æŒ waylandï¼Œè¿˜é¡»å®‰è£… plasma-wayland-session
  pacamn -S --needed plasma-wayland-session
  ```
- Xfceï¼ˆè½»é‡ç¨³å®šï¼Œå®æµ‹å†…å­˜å ç”¨åªæœ‰ 600M å·¦å³ï¼Œé€‚åˆæ€§èƒ½ä¸€èˆ¬ï¼Œå†…å­˜è¾ƒå°çš„æœºå™¨ï¼‰ã€‚Xfce é»˜è®¤ä½¿ç”¨ Xfwm ä½œä¸ºçª—å£ç®¡ç†å™¨ï¼ˆWindow Managerï¼ŒWMï¼‰ã€‚
  ```sh
  pacman -S --needed xfce4 xfce4-goodies
  # ç”±äº xfce æ¡Œé¢ç¯å¢ƒå¹¶ä¸è‡ªå¸¦ç½‘ç»œç®¡ç†å™¨æ‰˜ç›˜ç»„ä»¶ï¼Œæ‰€ä»¥å®‰è£…è¿™ä¸ª
  pacman -S --needed network-manager-applet
  ```

#### æ˜¾ç¤ºç®¡ç†å™¨ï¼ˆDisplay managerï¼‰

- [Display manager (ç®€ä½“ä¸­æ–‡) - ArchWiki](<https://wiki.archlinux.org/index.php/Display_manager_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)>)

è®¸å¤šæ¡Œé¢ç¯å¢ƒæä¾›äº†æ˜¾ç¤ºç®¡ç†å™¨**æ¥è‡ªåŠ¨å¯åŠ¨å›¾å½¢ç•Œé¢ï¼ˆå¯é€‰æ‹© X11 å’Œ Waylandï¼‰å’Œç®¡ç†ç”¨æˆ·ç™»å½•**ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨æ˜¾ç¤ºç®¡ç†å™¨ï¼Œè€Œæ˜¯ä½¿ç”¨ [xinit](<https://wiki.archlinux.org/index.php/Xinit_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E5%9C%A8%E7%99%BB%E5%BD%95%E6%97%B6%E8%87%AA%E5%8A%A8%E5%90%AF%E7%94%A8_X>) ç›´æ¥ä» tty å¯åŠ¨å›¾å½¢ç•Œé¢ã€‚

- å¦‚æœä½ é€‰æ‹©äº† KDE æ¡Œé¢ç¯å¢ƒï¼Œæ¨èä½¿ç”¨ SDDM
  ```bash
  # sddm-git è¦é€šè¿‡ aur å®‰è£…ï¼Œä½†æ˜¯æ²¡æ³•é€šè¿‡ paru -Sau è¿›è¡Œæ›´æ–°ï¼Œå»ºè®®æ¯éš”ä¸€æ®µæ—¶é—´é‡æ–° makepkg -si
  pacman -S --needed sddm-git
  # å¯ç”¨ sddm.serviceï¼Œè¿™æ ·æ¯æ¬¡å¼€æœºéƒ½ä¼šå¯åŠ¨ sddm
  # --now é€‰é¡¹è¡¨ç¤ºç«‹å³å¯åŠ¨ sddm
  systemctl enable --now sddm
  ```
  åœ¨ sddm ç™»å½•è¿›å…¥å›¾å½¢ç•Œé¢åï¼Œä½ å¯ä»¥æ‰“å¼€ Yakuake ç»ˆç«¯æ¥è¿è¡Œå‘½ä»¤ã€‚ä½ å¯èƒ½ä¼šå‘ç°æ— æ³•ä½¿ç”¨è§¦æ§æ¿è¿›è¡Œç‚¹å‡»ï¼Œè¿™éœ€è¦åœ¨ç³»ç»Ÿè®¾ç½®->è§¦æ‘¸æ¿ä¸­è¿›è¡Œè®¾ç½®ï¼ˆä¹Ÿæœ‰å¯èƒ½æ˜¯ä½ çš„ç¬”è®°æœ¬é”ä½è§¦æ§æ¿äº†ï¼‰ã€‚
- å¦‚æœä½ é€‰æ‹©äº† Xfce æ¡Œé¢ç¯å¢ƒï¼Œæ¨èä½¿ç”¨ LightDM
  ```sh
  pacman -S --needed lightdm lightdm-gtk-greeter lightdm-gtk-greeter-settings
  # å¯ç”¨ lightdm.serviceï¼Œè¿™æ ·æ¯æ¬¡å¼€æœºéƒ½ä¼šå¯åŠ¨ lightdm
  # --now é€‰é¡¹è¡¨ç¤ºç«‹å³å¯åŠ¨ lightdm
  systemctl enable --now lightdm
  ```

### Btrfs å¿«ç…§

- [Snapper (ç®€ä½“ä¸­æ–‡) - ArchWiki](<https://wiki.archlinux.org/index.php/Snapper_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)>)
- [ç”¨ snapper è½»æ¾ç©è½¬ Btrfs çš„å¿«ç…§åŠŸèƒ½ - ã€Œå·²æ³¨é”€ã€çš„æ–‡ç«  - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/31082518)

åœ¨ Btrfs ä¸­ï¼Œsnapper æ˜¯ä»¥å­å·ä¸ºå•ä½ç®¡ç†å¿«ç…§çš„ã€‚æˆ‘ä»¬è¦å…ˆä¸ºå­å·å»ºç«‹é…ç½®æ–‡ä»¶æ‰èƒ½ç®¡ç†å¿«ç…§ã€‚

```sh
# å®‰è£… snapper
sudo pacman -S snapper

# åˆ›å»º snapper é…ç½®æ–‡ä»¶
# snapper -c <é…ç½®åç§°> create-config <å­å·è·¯å¾„>
sudo snapper -c root create-config /
sudo snapper -c home create-config /home

# å…¶ä»–ç”¨æ³•
# åˆ é™¤é…ç½®æ–‡ä»¶
sudo snapper -c <é…ç½®åç§°> delete-config
# åˆ—å‡ºç°æœ‰é…ç½®æ–‡ä»¶
snapper list-configs
```

ä¸€ä¸ªå¿«ç…§æ—¶é—´çº¿(timeline)ç”±å¯é…ç½®æ•°ç›®çš„æ¯å°æ—¶/æ—¥/æœˆ/å¹´å¿«ç…§ç»„æˆã€‚å½“è‡ªåŠ¨æŒ‰æ—¶åˆ›å»ºå¯ç”¨æ—¶ï¼Œé»˜è®¤æ¯å°æ—¶åˆ›å»ºä¸€ä¸ªå¿«ç…§ã€‚æ¯å¤©ç”±æ—¶é—´çº¿æ¸…ç†ç®—æ³•æ¸…ç†å¤šä½™å¿«ç…§ã€‚

é»˜è®¤é…ç½®å°†ä¿ç•™ 10 ä¸ªæ¯å°æ—¶å¿«ç…§ï¼Œ10 ä¸ªæ¯æ—¥å¿«ç…§ï¼Œ10 ä¸ªæ¯æœˆå¿«ç…§å’Œ 10 ä¸ªæ¯å¹´å¿«ç…§ã€‚ä½ å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ `/etc/snapper/configs/<é…ç½®åç§°>` ä¸­æ›´æ”¹è¿™äº›é™åˆ¶ï¼Œç‰¹åˆ«æ˜¯åœ¨ç¹å¿™çš„å­å·ï¼Œä¾‹å¦‚ `/` ä¸Šã€‚

```sh
# å¯ç”¨è‡ªåŠ¨æŒ‰æ—¶åˆ›å»ºå¿«ç…§
sudo systemctl enable --now snapper-timeline.timer
# å¯ç”¨å®šæœŸæ¸…ç†è€æ—§å¿«ç…§
sudo systemctl enable --now snapper-cleanup.timer
```

å¿«ç…§ä¼šæ”¾åˆ°å­å·çš„ .snapshots ç›®å½•ä¸‹ã€‚

å…¶ä»–çš„æ“ä½œï¼Œæ¯”å¦‚æ›´æ”¹åˆ›å»ºå’Œæ¸…ç†é¢‘ç‡ã€æ‰‹åŠ¨åˆ›å»ºå¿«ç…§ç­‰è¯¦è§ ArchWikiã€‚

### zram

- [zram or zswap - ArchWiki](https://wiki.archlinux.org/title/improving_performance#zram_or_zswap)

zram-generator æ˜¯ä¸€ä¸ªç”¨ Rust å†™çš„ systemd unit generator for zram devicesã€‚

```bash
sudo pacman -S zram-generator
```

`sudo vim /etc/systemd/zram-generator.conf` å¡«å…¥å¦‚ä¸‹å†…å®¹ï¼š

```toml
# https://github.com/systemd/zram-generator
# https://man.archlinux.org/man/zram-generator.conf.5
[zram0]
```

```bash
# å¯ç”¨ zram
# create new device units
â¯ sudo systemctl daemon-reload
â¯ sudo systemctl start /dev/zram0
â¯ free -h

# æ¥ä¸‹æ¥å¯ç”¨ swapfile
â¯ touch /swapfile
# å¦‚æœåœ¨ btrfs ä¸Šåˆ™éœ€è¦ç¦ç”¨è¯¥æ–‡ä»¶çš„ CoW
â¯ chattr +C /swapfile
â¯ lsattr /swapfile
â¯ dd if=/dev/zero of=/swapfile bs=1G count=8 status=progress
# ä¼˜å…ˆçº§ä¸º 0ï¼ˆä½ï¼‰
â¯ chmod 600 /swapfile && mkswap /swapfile && swapon -p 0 /swapfile
# æŸ¥çœ‹äº¤æ¢åˆ†åŒº
â¯ swapon -s
Filename      Type        Size        Used    Priority
/dev/zram0    partition   4194300     0       100
/swapfile     file        8388604     0       0

# ç„¶åå†ä¿®æ”¹ä¸€ä¸‹ /etc/fstab
â¯ vim /etc/fstab
æŠŠå¦‚ä¸‹å†…å®¹æ”¾è¿›æ–‡ä»¶æœ«å°¾
/swapfile   none    swap    defaults,pri=0  0 0
```

### å­—ä½“

- [Fonts (ç®€ä½“ä¸­æ–‡) - ArchWiki](<https://wiki.archlinux.org/index.php/Fonts_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)>)
- [ä¿®æ­£ç®€ä½“ä¸­æ–‡æ˜¾ç¤ºä¸ºå¼‚ä½“ï¼ˆæ—¥æ–‡ï¼‰å­—å½¢ - ArchWiki](<https://wiki.archlinux.org/index.php/Localization_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)/Simplified_Chinese_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E4%BF%AE%E6%AD%A3%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87%E6%98%BE%E7%A4%BA%E4%B8%BA%E5%BC%82%E4%BD%93%EF%BC%88%E6%97%A5%E6%96%87%EF%BC%89%E5%AD%97%E5%BD%A2>)

```bash
# å®‰è£… noto-fonts
pacman -S --needed noto-fonts noto-fonts-cjk noto-fonts-emoji noto-fonts-extra
# æ›´çº±é»‘ä½“
pacman -S ttf-sarasa-gothic
```

ç„¶åæ‰“å¼€ System Settings->Regional Settings->Languageï¼Œç‚¹å‡» `Add languages`ï¼Œæ·»åŠ ç®€ä½“ä¸­æ–‡ï¼Œå¹¶å°†å…¶ç§»è‡³ç¬¬ä¸€ä¸ªï¼Œ`Apply` ä½¿å…¶ç”Ÿæ•ˆï¼Œç„¶åå† Log outï¼ˆæ³¨é”€ï¼‰é‡æ–°ç™»å½•ï¼Œå°±ä¼šæ˜¯ä¸­æ–‡å›¾å½¢ç•Œé¢äº†ã€‚

æ¥ä¸‹æ¥ä¿®æ­£ç®€ä½“ä¸­æ–‡æ˜¾ç¤ºä¸ºå¼‚ä½“ï¼ˆæ—¥æ–‡ï¼‰å­—å½¢çš„é—®é¢˜ï¼Œ`vim ~/.fonts.conf`ï¼Œå†™å…¥å¦‚ä¸‹å†…å®¹ï¼š

```xml
<?xml version="1.0"?>
<!DOCTYPE fontconfig SYSTEM "fonts.dtd">
<fontconfig>
  <alias>
    <!-- æ— è¡¬çº¿å­—ä½“ -->
    <family>sans-serif</family>
    <prefer>
      <family>Noto Sans</family>
      <family>Noto Sans CJK SC</family>
      <family>Noto Sans CJK TC</family>
      <family>Noto Sans CJK JP</family>
    </prefer>
  </alias>
</fontconfig>
```

ç„¶åï¼š

```bash
# æ›´æ–°å­—ä½“ç¼“å­˜å³å¯ç”Ÿæ•ˆ
fc-cache -fv
# æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ï¼Œå¦‚æœå‡ºç° NotoSansCJK-Regular.ttc: "Noto Sans CJK SC" "Regular" åˆ™è¡¨ç¤ºè®¾ç½®æˆåŠŸ
fc-match sans-serif
# æŸ¥çœ‹å®‰è£…äº†çš„ä¸­æ–‡å­—ä½“
fc-list :lang=zh
```

å¦‚æœè¦è®¾ç½®ç­‰å®½å­—ä½“ä¸ºæ›´çº±é»‘ä½“ï¼Œé‚£å°±åœ¨`<fontconfig>`æ ‡ç­¾å†…å†åŠ ä¸Šï¼š

```xml
  <alias>
    <!-- ç­‰å®½å­—ä½“ -->
    <family>monospace</family>
    <prefer>
      <family>Sarasa Mono SC</family>
    </prefer>
  </alias>
```

å…¶ä»–ï¼šserif æ˜¯è¡¬çº¿å­—ä½“

#### å¾®è½¯å­—ä½“

- [Microsoft fonts - ArchWiki](https://wiki.archlinux.org/title/Microsoft_fonts)
- [ttf-ms-win11 - AUR](https://aur.archlinux.org/cgit/aur.git/tree/PKGBUILD?h=ttf-ms-win11)

å¾®è½¯çš„å­—ä½“ï¼Œæ¯”å¦‚å¾®è½¯é›…é»‘ï¼š`msyh.ttc msyhbd.ttc msyhl.ttc`ã€‚è½¯ä»¶åŒ… `ttf-ms-fonts` æä¾›çš„å­—ä½“å·²ç»è¿‡æ—¶ï¼Œæ˜¾ç¤ºæ•ˆæœå¥‡å·®ï¼Œåˆ«ç”¨ã€‚å»ºè®®ç›´æ¥ä» win10 æˆ–è€… ISO å®‰è£…ä»‹è´¨ä¸­å¤åˆ¶å­—ä½“æ–‡ä»¶ï¼ˆç”±äºç‰ˆæƒåŸå› ä¸ä¼šæä¾›æ„å»ºå¥½çš„è½¯ä»¶åŒ…ï¼‰ï¼Œç„¶ååˆ·æ–°å­—ä½“ç¼“å­˜ã€‚

ä¾‹å¦‚ï¼ŒWindows çš„ `C:\` ç›˜è¢«æŒ‚è½½åœ¨ `/path-to-windows`ï¼š

```bash
sudo mkdir /usr/share/fonts/WindowsFonts
sudo cp /path-to-windows/Windows/Fonts/* /usr/share/fonts/WindowsFonts
sudo chmod 644 /usr/share/fonts/WindowsFonts/*
# é‡æ–°ç”Ÿæˆå­—ä½“ç¼“å­˜
fc-cache -f
```

æˆ–è€…æ˜¯å®‰è£… aur åŒ… `ttf-ms-win11`ï¼Œå®‰è£…æ–¹æ³•è¯¦è§[å…¶ PKGBUILD æ–‡ä»¶é¡¶éƒ¨çš„æ³¨é‡Š](https://aur.archlinux.org/cgit/aur.git/tree/PKGBUILD?h=ttf-ms-win11)ã€‚å¦‚æœå«Œéº»çƒ¦ï¼Œå¯ä»¥å®‰è£…ç¬¬ä¸‰æ–¹å·²ç»æ„å»ºå¥½çš„ï¼ˆæœ‰å®‰å…¨é£é™©ï¼‰ï¼š

```bash
# https://pkgs.org/download/ttf-ms-win10
# æŒ‰ç…§æè¿°æ·»åŠ ç¬¬ä¸‰æ–¹çš„è½¯ä»¶åŒ…ä»“åº“ï¼šhttps://dx37.gitlab.io/dx37essentials/
# å®‰è£…
sudo pacman -Syy
# åˆ«å®‰è£… japanese,korean,zh_tw çš„ï¼Œåœ¨æŸäº›ç½‘ç«™ä¸Šä¼šæœ‰å¼‚ä½“å­—çš„é—®é¢˜ï¼ˆéœ€è¦ä¿®æ”¹ ~/.fonts.confï¼‰
sudo pacman -S --needed ttf-ms-win10 ttf-ms-win10-zh_cn
```

### è¾“å…¥æ³•

è§ [fcitx5.md](./fcitx5.md)

### ä»£ç†

- [ArchWiki æ¨èçš„ä»£ç†è½¯ä»¶](<https://wiki.archlinux.org/title/General_recommendations_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E4%BB%A3%E7%90%86>)

Qv2ray å› ä¸ºä¸€äº›åŸå› å·²ç»åœæ­¢ç»´æŠ¤äº†ã€‚
å¯ä»¥å°è¯• v2rayA(~~v2ray for Arch~~)ï¼Œå®ƒæ”¯æŒä½¿ç”¨ RoutingA ä¹¦å†™è·¯ç”±è§„åˆ™ã€‚[v2rayA çš„é…ç½®](./v2raya.md)ã€‚
æ›´æ¨è clash verge

### AUR - Arch ç”¨æˆ·è½¯ä»¶æº

- [AUR helpers (ç®€ä½“ä¸­æ–‡) - ArchWiki](<https://wiki.archlinux.org/title/AUR_helpers_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)>)

paru æ˜¯ä¸€ä¸ªç”¨ Rust å†™çš„ AUR helperï¼ŒåŒæ—¶è¿˜æ˜¯å¯¹ pacman çš„åŒ…è£…ï¼Œä¼šè°ƒç”¨ `sudo pacman ...` æ¥å®‰è£…è½¯ä»¶åŒ…ï¼Œç”¨æ³•ä¸ pacman ç›¸ä¼¼å¹¶ä¸”æä¾›äº†ä¸€äº›æ›´å¥½ç”¨çš„åŠŸèƒ½ï¼Œå¹³æ—¶æˆ‘éƒ½æ˜¯ä½¿ç”¨ paru è€Œé pacman

```sh
# æ³¨ï¼šè¯·ç¡®ä¿å·²ç»æ·»åŠ  archlinuxcn è½¯ä»¶æºï¼Œå¦åˆ™ä¼šæ‰¾ä¸åˆ° paru è¿™ä¸ªè½¯ä»¶åŒ…
sudo pacman -S paru
```

### å¸¸ç”¨è½¯ä»¶

è½¯ä»¶å®‰åˆ©ç¯èŠ‚ï¼ˆ

- [å¸¸ç”¨è½¯ä»¶ | archlinux ç®€æ˜æŒ‡å—](https://arch.icekylin.online/app/common/daily.html)

åªåˆ—å‡ºåŒ…åï¼Œæ³¨æ„æœ‰äº›æ˜¯åœ¨ aur é‡Œçš„

```bash
# Ark å‹ç¼©æ–‡ä»¶ç®¡ç†å·¥å…·ï¼Œä»¥åŠ 7Z å’Œ RAR æ ¼å¼æ”¯æŒ
# unarchiver æä¾›çš„ unar å‘½ä»¤è§£å‹ Windows ä¸‹çš„å‹ç¼©åŒ…æ—¶ä¼šè‡ªåŠ¨æ£€æµ‹ç¼–ç ï¼Œæ”¯æŒ rar zip ç­‰ç»å¤§å¤šæ•°æ ¼å¼
paru --needed ark p7zip unarchiver
# zip å‘½ä»¤è¡Œè§£å‹å·¥å…·
unzip

wget
# df çš„æ›¿ä»£å“ã€‚ç”¨äºæŸ¥çœ‹ç£ç›˜ç©ºé—´å ç”¨æƒ…å†µ
dust
# æ–‡ä»¶ç®¡ç†å™¨
dolphin
# å›¾å½¢åŒ–ç•Œé¢ç›´è§‚æŸ¥çœ‹ç£ç›˜å ç”¨æƒ…å†µ
filelight
# ä¸¤ä¸ªç»ˆç«¯æ¨¡æ‹Ÿå™¨
yakuake alacritty
# pdf åŠç”µå­ä¹¦é˜…è¯»å™¨ï¼Œå¸¦æ‰¹æ³¨ç¼–è¾‘åŠŸèƒ½
okular
# firefox æˆ– edge æµè§ˆå™¨
firefox
microsoft-edge-stable-bin

# Smartmontools é€šè¿‡ä½¿ç”¨è‡ªæˆ‘ç›‘æ§ï¼ˆSelf-Monitoringï¼‰ã€åˆ†æï¼ˆAnalysisï¼‰å’ŒæŠ¥å‘Šï¼ˆReportingï¼‰ä¸‰ç§æŠ€æœ¯ï¼ˆSMARTï¼‰æ¥ç®¡ç†å’Œç›‘æ§å­˜å‚¨ç¡¬ä»¶ã€‚
# sudo smartctl -a /dev/nvme0n1 æŸ¥çœ‹ç£ç›˜çš„æ‰€æœ‰ SMART ä¿¡æ¯
smartmontools
# cpu gpu ä¿¡æ¯ï¼Œæ¸©åº¦ï¼Œæ€§èƒ½æµ‹è¯•
cpu-x
# æŸ¥çœ‹ç³»ç»Ÿç»å¤§éƒ¨åˆ†ç¡¬ä»¶ä¿¡æ¯
dmidecode
# å›¾å½¢ç•Œé¢ç£ç›˜åˆ†åŒºå·¥å…·
gparted

# åœ¨ wayland ä¸‹ flameshot éœ€è¦ xdg-desktop-portal
# å»ºè®®ç»™ flameshot gui å‘½ä»¤å¼„ä¸ªå¿«æ·é”®
flameshot xdg-desktop-portal
# spectacle è¿˜æœ‰å½•å±åŠŸèƒ½ï¼Œå»ºè®®ç»™â€œæˆªå–çŸ©å½¢åŒºåŸŸâ€å¼„ä¸ªå¿«æ·é”®
spectacle

# èŠå¤©å·¥å…·
# Telegramï¼Œç®€ä½“ä¸­æ–‡è¯­è¨€åŒ…ï¼šhttps://t.me/setlanguage/zhcncc
paru --needed telegram-desktop
# linuxqq https://wiki.archlinuxcn.org/wiki/%E8%85%BE%E8%AE%AFQQ
# èŠå¤©è®°å½•ä¿å­˜åœ¨ ~/.config/QQ/ æ–‡ä»¶é»˜è®¤ä¿å­˜åœ¨ ~/Downloads
# å¦‚æœé—ªé€€ï¼Œå®‰è£…å› 2:3.0.0_571-1 ç‰ˆæœ¬
# æˆ–è€… rm -rf ~/.config/QQ/crash_files && ln -sf /dev/null ~/.config/QQ/crash_files
paru -S linuxqq-nt-bwrap

# ç™¾åº¦ç½‘ç›˜ ç½‘æŠ‘äº‘ é’‰é’‰ xmind
paru --needed baidunetdisk-bin netease-cloud-music-gtk dingtalk-electron xmind-2020

# ä¸€ä¸ªç¨³å®šã€ç”¨æˆ·å‹å¥½ä»¥åŠé«˜åº¦å¯å®šåˆ¶çš„éŸ³ä¹æ’­æ”¾å™¨ https://github.com/feeluown/FeelUOwn
paru --needed feeluown feeluown-qqmusic feeluown-netease
# å¯ä»¥æœç´¢å’Œæ’­æ”¾æ¥è‡ªç½‘æ˜“äº‘éŸ³ä¹ï¼ŒQQéŸ³ä¹ï¼Œé…·ç‹—éŸ³ä¹ï¼Œé…·æˆ‘éŸ³ä¹ï¼ŒBilibiliï¼Œå’ªå’•éŸ³ä¹ç½‘ç«™çš„æ­Œæ›²
# listen1 ä¹Ÿä¸é”™ http://listen1.github.io/listen1/
# æ›´æ¨è spotify https://open.spotify.com/

# WPS ä»¥åŠå…¶éƒ¨åˆ†å¯é€‰ä¾èµ–
paru --needed wps-office-cn wps-office-mime-cn wps-office-mui-zh-cn
# å®‰è£… WPS éœ€è¦çš„å­—ä½“ï¼Œå­—ä½“ç¼ºå¤±å¯èƒ½ä¼šå¯¼è‡´ WPS å¡é¡¿
paru --needed ttf-wps-fonts wps-office-fonts

# ä¹Ÿå¯ä»¥é€‰æ‹© LibreOffice ç¨³å®šç‰ˆ
paru --needed libreoffice-still libreoffice-still-zh-cn

# vscode
paru --needed visual-studio-code-bin

# æ‚é¡¹
paru --needed  pacman-contrib downgrade
# ä¸€äº›å‘½ä»¤è¡Œå·¥å…·
paru --needed neofetch exa bat lolcat fd tokei zenith-bin

# å¦‚æœç»ˆç«¯ç¨‹åºä¸æ”¯æŒ http_proxy ç­‰ç¯å¢ƒå˜é‡ï¼Œå°±ç”¨è¿™ä¸ª
# ç¼ºç‚¹ï¼šå¯¹ go ç¨‹åºæ— æ•ˆ
proxychains-ng

# åšæœäº‘ã€‚å¦‚æœæ‰“å¼€çš„ç•Œé¢ä¸èƒ½è°ƒæ•´å¤§å°ï¼ŒæŒ‰ä¸€ä¸‹å›è½¦å°±å¥½ã€‚å¦‚æœå®åœ¨ç”¨ä¸äº†å°±æ‰‹åŠ¨å®‰è£…å®˜ç½‘çš„
# https://www.jianguoyun.com/s/downloads/linux#install_for_kdexfce
paru --needed nutstore

# ç”¨æ¥åˆ¶ä½œå¯åŠ¨ç›˜çš„ ventoy
# ä½¿ç”¨æ–¹æ³•ï¼šåœ¨æœªæŒ‚è½½Uç›˜çš„æƒ…å†µä¸‹ï¼Œsudo ventoygui æˆ– sudo ventoyweb
paru ventoy-bin

# æ–‡å­—è¯†åˆ«ï¼ˆéœ€è¦é…ç½®å¥½æ¥å£å‚æ•°ï¼‰
# ä¹Ÿå¯ä»¥ç”¨ telegram é‡Œçš„ OCRğŸ¤–
paru fastocr
```

### zsh

è§ [hyuuko/dotfiles](https://github.com/hyuuko/dotfiles)

### å¼€å‘ç¯å¢ƒ

è§ [development.md](./development.md)

### ç¾åŒ–

è§ [ç¾åŒ–.md](./ç¾åŒ–.md)

## å…¶ä»–

### kwallet

è§ [kwallet](./kwallet.md)

### è°ƒæ•´é¼ æ ‡æ»šè½®é€Ÿåº¦

**å·²å¼ƒç”¨ï¼Œæˆ‘ç°åœ¨ç›´æ¥åœ¨ç³»ç»Ÿè®¾ç½®é‡Œè®¾ç½®çš„æ»šåŠ¨é€Ÿåº¦**

ç³»ç»Ÿè®¾ç½®é‡Œåªèƒ½è°ƒæ•´é¼ æ ‡æ»šè½®çš„å…¨å±€é€Ÿåº¦ã€‚å¦‚æœè¦é’ˆå¯¹æŸä¸ªåº”ç”¨ç¨‹åºï¼Œå°±éœ€è¦ä½¿ç”¨ imwheelã€‚

```bash
sudo pacman -S imwheel
nvim ~/.imwheelrc
```

å†™å…¥å¦‚ä¸‹å†…å®¹å¹¶ä¿å­˜ï¼š

```bash
# https://wiki.archlinux.org/title/IMWheel
# imwheel -df åœ¨ç»ˆç«¯è¾“å‡ºå¹¶ä¸”æ ¹æ®é¼ æ ‡ä½ç½®æ¥é€‰å®šçª—å£ï¼ˆè€Œé focus çš„çª—å£ï¼‰
# imwheel -df --debug --kill | grep name ç”¨æ¥è°ƒè¯•ï¼Œæ»šåŠ¨æ—¶ä¼šè¾“å‡º name

# åªå¯¹ microsoft-edge å’Œ google-chrome ç”Ÿæ•ˆ
"^(microsoft-edge|google-chrome)"
None,      Up,   Button4, 3
None,      Down, Button5, 3
Control_L, Up,   Control_L|Button4
Control_L, Down, Control_L|Button5
Shift_L,   Up,   Shift_L|Button4
Shift_L,   Down, Shift_L|Button5
```

ç„¶åå°†å…¶ä½œä¸ºä¸€ä¸ªæœåŠ¡æ¥å¯åŠ¨ï¼Œæ–°å»ºæ–‡ä»¶ `~/.config/systemd/user/imwheel.service`ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹æ‰€ç¤ºã€‚ç„¶å `systemctl --user enable --now imwheel.service`ã€‚

```conf
[Unit]
Description=IMWheel
PartOf=graphical-session.target
After=graphical-session.target

[Service]
Type=exec
# ç¡çœ  20 ç§’æ˜¯å› ä¸º nvidia+wayland ä¸‹è¿›å…¥å›¾å½¢ç•Œé¢æ¯”è¾ƒæ…¢
# ExecStartPre=/usr/bin/sleep 20
# ä½¿ç”¨ X11 æ—¶ï¼Œ-X :0
# ä½¿ç”¨ wayland æ—¶ï¼Œ-X :1
ExecStart=/usr/bin/imwheel -df -X :1
ExecStop=/usr/bin/pkill imwheel
RemainAfterExit=yes
# å¯ä»¥è¯•è¯•ä¸ç”¨ -X :1 é€‰é¡¹ï¼Œè€Œæ˜¯ç”¨ DISPLAY ç¯å¢ƒå˜é‡ï¼Œæˆ‘è¯•äº†æ²¡ç”¨ï¼ˆ
# Environment=DISPLAY=:1

[Install]
WantedBy=graphical-session.target
```

### æ˜¾ç¤ºå™¨äº®åº¦

- [How to change LCD brightness from command line (or via script)?](https://askubuntu.com/a/149264)
- [Backlight - ArchWiki](https://wiki.archlinux.org/title/backlight)

æ™šä¸Šå…³ç¯åæ¼†é»‘ä¸€ç‰‡ï¼Œå³ä½¿å¤–æ¥æ˜¾ç¤ºå™¨çš„äº®åº¦è°ƒåˆ°æœ€æš—ï¼Œè¿˜æ˜¯ä¼šè§‰å¾—åˆºçœ¼ï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡ color correction åœ¨è½¯ä»¶å±‚é¢ä¿®æ”¹äº®åº¦ã€‚

**å¯¹äº Xorg**

```bash
# è°ƒæ•´äº®åº¦
brightness() {
    typeset -F b=$1
    (( b >= 0.3 && b <= 1.2 )) &&
        xrandr --output "$(xrandr | grep -w connected | cut -f '1' -d ' ')" --brightness $b ||
        echo 'usage: brightness num, 0.3 <= num <= 1.2'
}
```

`--brightness brightness` å°†å½“å‰é™„åŠ åˆ°è¾“å‡ºçš„ crtc ä¸Šçš„ä¼½é©¬å€¼ä¹˜ä»¥æŒ‡å®šçš„æµ®ç‚¹å€¼ã€‚é€‚ç”¨äºè¿‡äº®æˆ–è¿‡æš—çš„è¾“å‡ºã€‚ä½†æ˜¯ï¼Œè¿™åªæ˜¯ä¸€ä¸ªè½¯ä»¶ä¿®æ”¹ï¼Œå¦‚æœæ‚¨çš„ç¡¬ä»¶æ”¯æŒå®é™…æ›´æ”¹äº®åº¦ï¼Œæ‚¨å¯èƒ½æ›´å–œæ¬¢ä½¿ç”¨ xbacklightï¼ˆåªé€‚ç”¨äº Intel å’Œ X11ï¼‰ã€‚

**å¯¹äº Wayland**
ä¹Ÿè®¸å¯ä»¥è¯•è¯• colord-kdeã€‚
color management protocol è¿˜æœªå®Œæˆ [WIP: unstable: add color management protocol (!14) Â· Merge requests Â· wayland / wayland-protocols Â· GitLab](https://gitlab.freedesktop.org/wayland/wayland-protocols/-/merge_requests/14)

### æ›´æ¢å†…æ ¸

- [Kernel - ArchWiki](https://wiki.archlinux.org/title/kernel) é™¤äº† linux ä¹‹å¤–ï¼Œè¿˜æœ‰ linux-ltsã€linux-zenã€‚
- [Details about linux-zen](https://liquorix.net/)

```sh
# linux-zen ä»¥ååé‡å’ŒåŠŸè€—ä¸ºä»£ä»·è°ƒæ•´å†…æ ¸ä»¥æé«˜å“åº”èƒ½åŠ›ï¼Œè€Œä¸”è¿˜è‡ªå¸¦ Anbox éœ€è¦çš„æ¨¡å—
sudo pacman -S linux-zen linux-zen-headers
# stable ç‰ˆçš„ linux kernel å¯ä»¥å¸è½½æ‰
# sudo pacman -Rns linux linux-headers

# ç”Ÿæˆ grub é…ç½®æ–‡ä»¶ï¼ˆå³æ›´æ–° grub ç•Œé¢çš„é€‰æ‹©èœå•ï¼‰
sudo grub-mkconfig -o /boot/grub/grub.cfg
```

linux-lts çš„å†…æ ¸ç‰ˆæœ¬é€šå¸¸è½åçš„æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥éœ€è¦æ³¨æ„ä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚ï¼š

- 5.7 å¼€å§‹æ‰æ”¯æŒ amd 4000 ç³»åˆ—çš„ cpu
- 5.15 å¼€å§‹æ‰åŸç”Ÿæ”¯æŒ ntfs3 æ–‡ä»¶ç³»ç»Ÿï¼Œæ›´ä½ç‰ˆæœ¬çš„å†…æ ¸åˆ™éœ€è¦å®‰è£… ntfs-3g è½¯ä»¶åŒ…

### æ ¡å›­ç½‘

- [Drcom (ç®€ä½“ä¸­æ–‡) - ArchWiki](<https://wiki.archlinux.org/index.php/Drcom_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)>)
- [mchome/dogcom](https://github.com/mchome/dogcom)

å­¦æ ¡æä¾›çš„ linux ç‰ˆå®¢æˆ·ç«¯ç»å¸¸æ‰çº¿ï¼Œæ•…é€‰æ‹©ä½¿ç”¨ dogcomã€‚

åœ¨ windows ä¸Šä½¿ç”¨å­¦æ ¡æä¾›çš„å®¢æˆ·ç«¯ï¼Œåœ¨ç™»å½•å‰ç”¨ wireshark å¼€å§‹æˆªåŒ…ï¼Œä¿å­˜æ–‡ä»¶ã€‚æ¥ç€ä¸‹è½½[é…ç½®æ–‡ä»¶ç”Ÿæˆå™¨](https://raw.githubusercontent.com/drcoms/generic/master/drcom_d_config.py)ï¼Œå°†å…¶ä¸ç¬¬ä¸€æ­¥çš„æˆªåŒ…æ–‡ä»¶æ”¾åˆ°åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œå¹¶ä¸”å°† `filename = '3.pcapng'` ä¸­çš„ `3.pcapng` æ”¹ä¸ºç¬¬ä¸€æ­¥ä¿å­˜çš„æ–‡ä»¶åã€‚æ¥ç€ `python2 drcom_d_config.py > dhcp.conf`ã€‚æˆ‘å¾—åˆ°çš„å†…å®¹ä¸ºï¼š

```conf
server = '10.254.7.4'
username='20180000'
password=''
CONTROLCHECKSTATUS = '\x00'
ADAPTERNUM = '\x00'
host_ip = '10.234.115.96'
IPDOG = '\x01'
host_name = 'GILIGILIEYE'
PRIMARY_DNS = '0.0.0.0'
dhcp_server = '0.0.0.0'
AUTH_VERSION = '\x30\x00'
mac = 0x000000000000
host_os = 'NOTE7'
KEEP_ALIVE_VERSION = '\xdc\x02'
ror_version = False
```

éœ€è¦å°† `password` æ”¹ä¸ºä½ è‡ªå·±çš„ï¼Œå¹¶ä¸”æ·»åŠ  `keepalive1_mod`ï¼š

```conf
server = '10.254.7.4'
username='20180000'
password='114514'
CONTROLCHECKSTATUS = '\x00'
ADAPTERNUM = '\x00'
host_ip = '10.234.115.96'
IPDOG = '\x01'
host_name = 'GILIGILIEYE'
PRIMARY_DNS = '0.0.0.0'
dhcp_server = '0.0.0.0'
AUTH_VERSION = '\x30\x00'
mac = 0x000000000000
host_os = 'NOTE7'
KEEP_ALIVE_VERSION = '\xdc\x02'
ror_version = False
keepalive1_mod = True
```

åœ¨ linux ä¸­ï¼Œå…ˆ `paru --needed dogcom-git` å®‰è£… dogcomï¼Œç„¶åå°† `/etc/dogcom.d/dhcp.conf` ä¿®æ”¹æˆä¸Šé¢çš„æ ·å­ï¼Œæœ€åå¯ç”¨ dogcom æœåŠ¡ï¼š

```bash
sudo systemctl enable --now dogcom-d
# æŸ¥çœ‹çŠ¶æ€ï¼Œå¦‚æœæ˜¾ç¤º Active: active (running)ï¼Œåˆ™è¯´æ˜æˆåŠŸäº†
systemctl status dogcom-d
```

## Tips & Tricks

è§ [tips_and_tricks.md](./tips_and_tricks.md)

## Dotfiles ç®¡ç†

- [Dotfiles - ArchWiki](https://wiki.archlinux.org/title/Dotfiles)

## ç³»ç»Ÿç»´æŠ¤

è§ [sysadmin.md](./sysadmin.md)

## å¸¸è§é—®é¢˜æ’é™¤ä¸è§£å†³

è§ [troubleshooting.md](./troubleshooting.md)

## è®¾å¤‡

### è“ç‰™

```bash
# å¯ç”¨è“ç‰™æœåŠ¡
sudo systemctl enable --now bluetooth
# å¦‚æœè¦è¿æ¥è“ç‰™éŸ³é¢‘è®¾å¤‡ï¼Œéœ€è¦å®‰è£… pulseaudio-bluetooth å¹¶é‡å¯ pulseaudio
sudo pacman -S pulseaudio-bluetooth
pulseaudio -k

# XXX ä¸è¿‡æ›´å»ºè®®ç›´æ¥ç”¨ pipewire å–ä»£ pulseaudioï¼Œpipewire è‡ªå¸¦äº†è“ç‰™çš„æ¨¡å—
# ç”¨ pipewire æ›¿ä»£ pulseaudioï¼ˆä¼šè¢«è‡ªåŠ¨å¸è½½ï¼‰
paru -S pipewire pipewire-alsa pipewire-pulse
```

### é¼ æ ‡å®

```bash
sudo pacman -S piper
```

ç„¶åå°†å‰è¿›å’Œåé€€æŒ‰é’®ç”±é»˜è®¤çš„ Forward å’Œ Backward è®¾ç½®ä¸º`Alt + right`ï¼ˆç‚¹å‡»é…ç½®å¯¹è¯æ¡†æœ«å°¾çš„ Send keystrokeï¼Œå…ˆæŒ‰ä½ Altï¼Œç„¶åæŒ‰ä¸‹å¹¶æ¾å¼€ Rightï¼Œæœ€åæ¾å¼€ Altï¼‰å’Œ`Alt + left`ï¼ˆchrome çš„å‰è¿›åé€€å¿«æ·é”®å°±æ˜¯è¿™ä¸ªï¼‰

è®¾ç½® vscode å®‰è£…æ’ä»¶ Windows Default Keybindingsï¼Œå¹¶ä¸”ç»™ vscode æ·»åŠ è®¾ç½®ä»¥ç¦ç”¨ä¸­é”®çš„å¤åˆ¶è¡Œä¸ºï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ä¸­é”®é€‰æ‹©å¤šè¡Œäº†ï¼š

```json
{
  "editor.selectionClipboard": false
}
```

## å…¶ä»–

### systemd based initial ramdisk

[mkinitcpio - ArchWiki](https://wiki.archlinux.org/title/Mkinitcpio)

åœ¨ /etc/mkinitcpio.conf çš„ HOOKS æ•°ç»„å†…ï¼Œæ·»åŠ  systemd ç„¶å mkinitcpio -P

ä¼šç¨å¾®æå‡å¯åŠ¨é€Ÿåº¦ã€‚
